<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Num√©rologie Strat√©gique - Grand Ma√Ætre</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #3a0ca3; --secondary-color: #7209b7; --background-color: #f5f3f4;
            --text-color: #212529; --card-bg: #ffffff; --border-radius: 12px;
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); --summary-border: #4361ee;
            --karmic-bg: #fffbe6; --karmic-border: #ffc107;
            --daily-vibration-bg: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%);
            --harmony-color: #2a9d8f; --challenge-color: #e76f51; --neutral-color: #f4a261;
        }
        body.dark-mode {
            --primary-color: #9d4edd; --secondary-color: #c77dff; --background-color: #121212;
            --text-color: #e0e0e0; --card-bg: #1e1e1e;
            --box-shadow: 0 6px 20px rgba(255, 255, 255, 0.05); --summary-border: #80ffdb;
            --karmic-bg: #332b00; --karmic-border: #ffc107;
            --daily-vibration-bg: linear-gradient(135deg, #2d1a3c 0%, #2c3e50 100%);
            --harmony-color: #80ffdb; --challenge-color: #ff9b85; --neutral-color: #ffcb77;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; transition: background-color 0.3s, color 0.3s; }
        .container { max-width: 800px; width: 100%; }
        header { text-align: center; margin-bottom: 20px; color: var(--primary-color); position: relative; }
        header h1 { font-family: 'Lora', serif; font-size: 2.5em; font-weight: 600; margin: 0; }
        nav.app-nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;}
        nav.app-nav button { padding: 10px 20px; font-size: 1em; background: transparent; color: var(--text-color); border: 2px solid transparent; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; }
        nav.app-nav button.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color); background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); }
        .tab-content { display: none; } .tab-content.active { display: block; animation: fadeIn 0.5s; }
        main { background: var(--card-bg); padding: 30px 40px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); transition: background-color 0.3s; }
        #welcome-back { padding: 15px; background-color: color-mix(in srgb, var(--summary-border) 20%, transparent); border: 1px solid var(--summary-border); color: var(--text-color); border-radius: var(--border-radius); margin-bottom: 20px; text-align: center; font-weight: 600; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: var(--border-radius); font-size: 1em; font-family: 'Poppins', sans-serif; box-sizing: border-box; background-color: var(--card-bg); color: var(--text-color); transition: border-color 0.3s, box-shadow 0.3s; }
        button { width: 100%; padding: 15px; background: linear-gradient(45deg, var(--secondary-color), var(--primary-color)); color: white; border: none; border-radius: var(--border-radius); font-size: 1.2em; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(58, 12, 163, 0.4); }
        button:disabled { background: #999; cursor: not-allowed; transform: translateY(0); box-shadow: none; }
        .card { opacity: 0; background-color: var(--card-bg); padding: 25px; margin-bottom: 25px; border-radius: var(--border-radius); border-left: 6px solid var(--secondary-color); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .card.fade-in { animation: fadeIn 0.5s ease-out forwards; }
        h2 { margin-top: 0; margin-bottom: 15px; color: var(--primary-color); display: flex; align-items: center; font-family: 'Lora', serif; font-size: 1.8em; }
        .number-circle {
            flex-shrink: 0; display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 60px; height: 60px; background-color: var(--secondary-color); color: white; border-radius: 50%;
            font-weight: 600; margin-right: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            cursor: pointer; transition: transform 0.2s; padding: 5px; box-sizing: border-box; font-size: 1.8em;
        }
        .number-circle:hover { transform: scale(1.1); }
        .number-circle .master-part { font-size: 0.7em; line-height: 1; font-weight: 700; }
        .number-circle .separator { width: 60%; margin: 1px 0; border: none; border-top: 2px solid rgba(255, 255, 255, 0.6); }
        .number-circle .base-part { font-size: 0.6em; line-height: 1; opacity: 0.9; }
        .daily-vibration-card { border: none; background: var(--daily-vibration-bg); color: #fff; }
        .daily-vibration-card h2, .daily-vibration-card .description, body.dark-mode .daily-vibration-card p { color: #fff; }
        .karmic-warning { background-color: var(--karmic-bg); border: 1px solid var(--karmic-border); border-radius: var(--border-radius); padding: 15px; margin-top: 20px; color: color-mix(in srgb, var(--karmic-border) 80%, #000 20%);}
        .methodology-note { font-size: 0.8em; opacity: 0.7; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee; }
        .action-buttons { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .action-buttons button { flex: 1 1 200px; }
        .ai-prompt-description { font-size: 0.85em; opacity: 0.8; margin: 8px 0 0 0; text-align: center; color: var(--text-color); width: 100%; }
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s; }
        .modal-content { background-color: var(--card-bg); margin: 10% auto; padding: 30px; border-top: 5px solid var(--primary-color); width: 80%; max-width: 600px; border-radius: var(--border-radius); position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .hidden { display: none; }
        .theme-switch-wrapper { display: flex; align-items: center; position: absolute; top: 15px; right: 15px; }
        .theme-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(26px); }
        #compatibility-results .card { border-left-width: 6px; }
        #compatibility-results .card.harmony { border-left-color: var(--harmony-color); }
        #compatibility-results .card.challenge { border-left-color: var(--challenge-color); }
        #compatibility-results .card.neutral { border-left-color: var(--neutral-color); }
        .energy-chart-svg-container { margin-top: 15px; }
        .energy-analysis { margin-top: 15px; padding: 15px; background-color: color-mix(in srgb, var(--primary-color) 5%, transparent); border-radius: var(--border-radius); }
        .life-cycles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .cycle-card { padding: 15px; border-radius: var(--border-radius); background-color: color-mix(in srgb, var(--primary-color) 5%, transparent); text-align: center; }
        .cycle-card h3 { font-family: 'Lora', serif; color: var(--primary-color); margin-top: 0; }
        footer a { color: var(--primary-color); text-decoration: none; font-weight: 600; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üîÆ Num√©rologie - Grand Ma√Ætre</h1>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-toggle"><input type="checkbox" id="theme-toggle" /><span class="slider round"></span></label>
            </div>
        </header>
        
        <nav class="app-nav">
            <button id="nav-theme" class="active">Mon Th√®me</button>
            <button id="nav-compatibility">Compatibilit√©</button>
        </nav>

        <main>
            <div id="theme-content" class="tab-content active">
                <div id="welcome-back" class="hidden"></div>
                <form id="numerology-form">
                    <div class="input-group"><label for="full-name">Vos Noms & Pr√©noms (de naissance)</label><input type="text" id="full-name" required></div>
                    <div class="input-group">
                        <label for="birth-date">Votre Date de naissance</label>
                        <input type="text" id="birth-date" required placeholder="JJ/MM/AAAA" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}">
                    </div>
                    <button type="submit">Calculer mon Th√®me Complet</button>
                </form>
                <div id="results-wrapper" class="hidden">
                    <div id="daily-vibration-container"></div>
                    <div id="summary-container"></div>
                    <div id="results-container"></div>
                    <div id="energy-presence-container"></div>
                    <div id="life-cycles-container"></div>
                    <div id="profile-card-container" class="hidden"><h2>üñºÔ∏è Votre Carte de Profil</h2><p>Faites un clic droit sur l'image pour la sauvegarder.</p><canvas id="profile-card-canvas"></canvas></div>
                    <div class="action-buttons">
                        <button id="ai-export-btn">‚ú® Analyser avec une IA</button>
                        <button id="profile-card-btn">üñºÔ∏è Cr√©er ma Carte</button>
                        <button id="print-btn">üñ®Ô∏è Imprimer / PDF</button>
                    </div>
                </div>
            </div>

            <div id="compatibility-content" class="tab-content">
                <h2>Analyse de Compatibilit√©</h2>
                <p>Comparez votre th√®me avec celui d'une autre personne pour d√©couvrir vos dynamiques relationnelles.</p>
                <form id="compatibility-form">
                    <h4>Personne 1 (Vous)</h4>
                    <div class="input-group"><label for="p1-full-name">Noms & Pr√©noms</label><input type="text" id="p1-full-name" required></div>
                    <div class="input-group"><label for="p1-birth-date">Date de naissance</label><input type="text" id="p1-birth-date" required placeholder="JJ/MM/AAAA" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}"></div>
                    <hr>
                    <h4>Personne 2</h4>
                    <div class="input-group"><label for="p2-full-name">Noms & Pr√©noms</label><input type="text" id="p2-full-name" required></div>
                    <div class="input-group"><label for="p2-birth-date">Date de naissance</label><input type="text" id="p2-birth-date" required placeholder="JJ/MM/AAAA" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}"></div>
                    <button type="submit">Analyser la Compatibilit√©</button>
                </form>
                <div id="compatibility-results" class="hidden"></div>
            </div>
        </main>
        <footer style="text-align:center; font-size: 0.9em; opacity: 0.7; padding: 20px 0;">
            <p>Application cr√©√©e pour la d√©couverte de soi. Ne remplace pas un conseil professionnel.</p>
            <p><a id="methodology-link">Notre M√©thodologie de Calcul</a></p>
        </footer>
    </div>
    
    <div id="glossary-modal" class="modal"><div class="modal-content"><span id="modal-close-btn" class="close-button">√ó</span><div id="modal-body"></div></div></div>
    <div id="methodology-modal" class="modal"><div class="modal-content"><span id="methodology-close-btn" class="close-button">√ó</span><div id="methodology-modal-body"></div></div></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const data = {
                letterValues: { 'A':1,'J':1,'S':1, 'B':2,'K':2,'T':2, 'C':3,'L':3,'U':3, 'D':4,'M':4,'V':4, 'E':5,'N':5,'W':5, 'F':6,'O':6,'X':6, 'G':7,'P':7,'Y':7, 'H':8,'Q':8,'Z':8, 'I':9,'R':9 },
                vowels: ['A', 'E', 'I', 'O', 'U', 'Y'],
                masterNumbers: [11, 22, 33],
                karmicDebtsMap: { 13: "la paresse et le travail", 14: "les abus des sens et l'instabilit√©", 16: "l'orgueil et la destruction de l'ego", 19: "l'√©go√Øsme et l'abus de pouvoir" },
                energyKeywords: { 1: "Leader", 2: "Diplomate", 3: "Cr√©atif", 4: "B√¢tisseur", 5: "Aventurier", 6: "Responsable", 7: "Sage", 8: "Puissant", 9: "Humaniste", 11: "Inspir√©", 22: "Grand B√¢tisseur", 33: "Guide" },
                methodologyText: {
                    title: "Notre Approche & M√©thodologie de Calcul",
                    content: `<p>Cette application s'inspire de la <strong>num√©rologie strat√©gique</strong>, une approche moderne qui vise √† fournir des cl√©s de compr√©hension de soi actionnables. Voici les principes de calcul utilis√©s :</p>
                    <ul>
                        <li><strong>R√©duction des nombres :</strong> Tous les nombres sont r√©duits √† un seul chiffre (de 1 √† 9), sauf les <strong>Ma√Ætres Nombres 11, 22 et 33</strong>, qui conservent leur propre vibration. L'application affiche ces nombres avec leur base (ex: 22/4) pour une analyse compl√®te.</li>
                        <li><strong>Nombre de l'√Çme (√âlan Spirituel) :</strong> Il est calcul√© en additionnant la valeur de toutes les voyelles de vos noms et pr√©noms de naissance. Conform√©ment √† une convention r√©pandue, la lettre <strong>'Y' est syst√©matiquement consid√©r√©e comme une voyelle</strong> dans nos calculs. Des √©coles diff√©rentes peuvent la traiter comme une consonne dans certains cas, ce qui peut expliquer des variations de r√©sultats.</li>
                        <li><strong>Nombre de Personnalit√© (Moi Intime) :</strong> Il est obtenu par la somme des consonnes de vos noms et pr√©noms.</li>
                        <li><strong>Nombre d'Expression (Potentiel) :</strong> Il est la somme de toutes les lettres (voyelles + consonnes).</li>
                        <li><strong>Dettes Karmiques :</strong> Nous identifions les dettes karmiques (13, 14, 16, 19) lorsqu'elles apparaissent comme r√©sultat interm√©diaire avant la r√©duction finale dans les nombres principaux. Elles repr√©sentent des d√©fis sp√©cifiques √† int√©grer.</li>
                    </ul>
                    <p>La num√©rologie est un outil de r√©flexion. Diff√©rentes approches (√©volutive, karmique, etc.) peuvent utiliser des variantes de calcul. Cet outil vous offre une base solide issue d'une m√©thode reconnue pour commencer votre exploration.</p>`
                },
                interpretations: {
                    cheminDeVie: { 1: "<strong>Le Leader :</strong> Votre mission est d'apprendre l'ind√©pendance et l'innovation. Le d√©fi est de croire en vos propres id√©es pour r√©aliser votre plein potentiel.", 2: "<strong>Le Diplomate :</strong> Votre chemin est celui de la coop√©ration et de l'harmonie. Votre potentiel se lib√®re en trouvant votre propre voix sans d√©pendre de l'approbation des autres.", 3: "<strong>Le Communicant :</strong> Votre mission est d'inspirer par la cr√©ativit√©. Le d√©fi est de ne pas disperser votre √©nergie pour transformer votre potentiel en r√©alisations concr√®tes.", 4: "<strong>Le B√¢tisseur :</strong> Votre mission est de construire et d'apporter de la stabilit√©. Votre principal axe de croissance est d'accepter la flexibilit√© pour √©viter les blocages.", 5: "<strong>L'Aventurier :</strong> Votre chemin est celui du changement et de la libert√©. Le d√©fi est de trouver un √©quilibre entre libert√© et discipline pour ne pas vous √©parpiller.", 6: "<strong>Le Responsable :</strong> Votre mission est li√©e au service et √† la famille. Le d√©fi est de trouver un √©quilibre entre donner et recevoir, pour ne pas tomber dans le sacrifice.", 7: "<strong>Le Sage :</strong> Votre chemin est celui de la connaissance et de l'introspection. Pour r√©aliser votre potentiel, le d√©fi est de partager votre sagesse sans vous isoler du monde.", 8: "<strong>Le Ma√Ætre :</strong> Votre mission est de ma√Ætriser le monde mat√©riel et le pouvoir. Le d√©fi est d'utiliser ce pouvoir avec sagesse et g√©n√©rosit√© pour un impact positif.", 9: "<strong>L'Humaniste :</strong> Votre chemin est celui de l'altruisme et de la compassion. Le principal d√©fi pour accomplir votre potentiel est d'apprendre √† l√¢cher prise.", 11: "<strong>L'Inspir√© (11/2) :</strong> Ma√Ætre nombre. Un chemin de grande intuition. Le d√©fi est de g√©rer une forte tension int√©rieure (propre au 11) et de trouver le courage d'incarner vos id√©aux √©lev√©s, tout en apprenant la diplomatie du 2.", 22: "<strong>Le Grand B√¢tisseur (22/4) :</strong> Ma√Ætre nombre. La capacit√© de transformer les r√™ves en r√©alit√©. Les d√©fis sont immenses, demandant l'√©thique du 22 et le travail acharn√© du 4 pour √©viter les freins de la pression.", 33: "<strong>Le Guide Spirituel (33/6) :</strong> Ma√Ætre nombre. Un chemin de service et de gu√©rison. Le d√©fi est de g√©rer ces lourdes responsabilit√©s (33) avec l'amour et l'√©quilibre du 6, sans vous oublier." },
                    expression: { 1: "<strong>Le Pionnier :</strong> Vos talents sont l'initiative et le leadership. Ce sont vos outils pour agir.", 2: "<strong>Le Partenaire :</strong> Vos dons sont la collaboration et la m√©diation. Utilisez-les pour cr√©er des liens.", 3: "<strong>L'Artiste Cr√©atif :</strong> Votre potentiel s'exprime par la communication et la cr√©ativit√©.", 4: "<strong>L'Organisateur :</strong> Vous avez un talent pour la planification et le travail m√©ticuleux, cr√©ant des fondations solides.", 5: "<strong>Le Communicateur Charismatique :</strong> Vos talents sont la polyvalence et l'adaptabilit√©, des outils puissants pour le changement.", 6: "<strong>Le Conseiller Protecteur :</strong> Vous avez un don pour le conseil. C'est votre mani√®re d'impacter le monde.", 7: "<strong>Le Chercheur de V√©rit√© :</strong> Vos talents sont l'analyse et la recherche pour comprendre le monde.", 8: "<strong>Le Manager Ambitieux :</strong> Vous poss√©dez un potentiel pour les affaires et la gestion de projets d'envergure.", 9: "<strong>L'Id√©aliste :</strong> Vos dons sont la compassion et une vision large des choses.", 11: "<strong>Le Visionnaire (11/2) :</strong> Vous avez le potentiel d'inspirer les autres par des id√©es novatrices (11) avec une grande sensibilit√© (2).", 22: "<strong>Le Ma√Ætre d'Oeuvre (22/4) :</strong> Vous pouvez g√©rer de grands projets (22) qui servent l'humanit√© avec une m√©thode concr√®te (4).", 33: "<strong>Le Grand Serviteur (33/6) :</strong> Votre potentiel est dans l'enseignement et la gu√©rison (33) au service des autres (6)." },
                    ame: { 1: "<strong>D√©sir d'Ind√©pendance :</strong> Vous aspirez √† diriger votre propre vie.", 2: "<strong>D√©sir d'Harmonie :</strong> Votre √¢me recherche l'amour, la paix et l'union.", 3: "<strong>D√©sir d'Expression :</strong> Vous avez un besoin vital de cr√©er et de communiquer.", 4: "<strong>D√©sir de Stabilit√© :</strong> Vous recherchez la s√©curit√© et un cadre solide.", 5: "<strong>D√©sir de Libert√© :</strong> Votre √¢me a soif de changement et d'aventure.", 6: "<strong>D√©sir de Service :</strong> Vous √™tes anim√© par le besoin de prendre soin des autres.", 7: "<strong>D√©sir de Connaissance :</strong> Vous avez un besoin de comprendre les myst√®res de la vie.", 8: "<strong>D√©sir de Ma√Ætrise :</strong> Vous aspirez au succ√®s et √† la ma√Ætrise du monde mat√©riel.", 9: "<strong>D√©sir d'Universalit√© :</strong> Votre √¢me est tourn√©e vers l'humanit√© et les grandes causes.", 11: "<strong>D√©sir de R√©v√©lation (11/2) :</strong> Vous cherchez √† vous connecter √† une conscience sup√©rieure (11) et √† partager en harmonie (2).", 22: "<strong>D√©sir de B√¢tir pour le Monde (22/4) :</strong> Vous voulez laisser un h√©ritage durable (22) et concret (4).", 33: "<strong>D√©sir de Gu√©rir (33/6) :</strong> Vous √™tes motiv√© par une compassion profonde (33) et le besoin de prendre soin (6)." },
                    personnalite: { 1: "<strong>L'Image du Chef :</strong> Vous apparaissez comme une personne confiante et ind√©pendante.", 2: "<strong>L'Image du Diplomate :</strong> Les autres vous voient comme quelqu'un de charmant et coop√©ratif.", 3: "<strong>L'Image de l'Artiste Sociable :</strong> On vous per√ßoit comme quelqu'un de p√©tillant et communicatif.", 4: "<strong>L'Image du Pilier Fiable :</strong> Vous projetez une image de s√©rieux, de stabilit√© et de fiabilit√©.", 5: "<strong>L'Image de l'Aventurier :</strong> On vous per√ßoit comme une personne magn√©tique et adaptable.", 6: "<strong>L'Image du Parent Universel :</strong> Les autres vous voient comme une personne chaleureuse et bienveillante.", 7: "<strong>L'Image du Sage Myst√©rieux :</strong> On vous per√ßoit comme quelqu'un d'intelligent et de r√©serv√©.", 8: "<strong>L'Image de la Puissance :</strong> Vous projetez une image de force, d'ambition et de contr√¥le.", 9: "<strong>L'Image de l'Humaniste :</strong> On vous per√ßoit comme une personne tol√©rante et g√©n√©reuse.", 11: "<strong>L'Image de l'Intuitif (11/2) :</strong> Vous semblez connect√© √† une autre r√©alit√© (11) tout en √©tant accessible (2).", 22: "<strong>L'Image du B√¢tisseur (22/4) :</strong> On per√ßoit votre potentiel √† r√©aliser de grandes choses (22) de mani√®re cr√©dible (4).", 33: "<strong>L'Image du Guide (33/6) :</strong> Vous d√©gagez une aura de compassion (33) et de bienveillance (6)." },
                    nombreActif: { 1: "<strong>Action Directe :</strong> Votre pr√©nom vous pousse √† agir de mani√®re directe et d√©cisive.", 2: "<strong>Action Collaborative :</strong> Vous agissez de pr√©f√©rence en collaboration.", 3: "<strong>Action Cr√©ative :</strong> Votre mani√®re d'agir est joyeuse et expressive.", 4: "<strong>Action M√©thodique :</strong> Vous agissez de fa√ßon planifi√©e et pers√©v√©rante.", 5: "<strong>Action Adaptable :</strong> Vous agissez de mani√®re rapide et flexible.", 6: "<strong>Action Responsable :</strong> Vos actions sont motiv√©es par le sens des responsabilit√©s.", 7: "<strong>Action R√©fl√©chie :</strong> Vous avez besoin d'analyser la situation avant de vous engager.", 8: "<strong>Action Ambitieuse :</strong> Votre mode d'action est puissant et orient√© vers un objectif.", 9: "<strong>Action Altruiste :</strong> Vous agissez souvent pour une cause plus grande que vous.", 11: "<strong>Action Inspir√©e (11/2) :</strong> Vous agissez selon votre intuition (11).", 22: "<strong>Action Constructive (22/4) :</strong> Vous √™tes pouss√© √† agir pour des projets concrets (22 et 4).", 33: "<strong>Action de Service (33/6) :</strong> Vos actions visent √† guider et aider les autres (33 et 6)." }
                },
                dailyVibration: { 1:"<strong>Initiative & Action :</strong> Journ√©e id√©ale pour d√©marrer de nouveaux projets et affirmer votre ind√©pendance. Prenez les devants !", 2:"<strong>Patience & Diplomatie :</strong> Ralentissez. C'est un jour pour √©couter, collaborer et faire preuve de tact. Favorisez les partenariats.", 3:"<strong>Cr√©ativit√© & Communication :</strong> Exprimez-vous ! Une excellente journ√©e pour socialiser, rire, cr√©er et partager vos id√©es avec optimisme.", 4:"<strong>Travail & Organisation :</strong> Concentrez-vous sur les d√©tails et le travail m√©thodique. Journ√©e parfaite pour ranger, planifier et construire des bases solides.", 5:"<strong>Changement & Aventure :</strong> Attendez-vous √† l'inattendu. Soyez flexible, ouvert aux nouvelles exp√©riences et pr√™t √† bouger. √âvitez la routine.", 6:"<strong>Harmonie & Responsabilit√©s :</strong> Le foyer et les relations sont au centre. Un jour pour prendre soin de vos proches, embellir votre environnement et assumer vos responsabilit√©s.", 7:"<strong>Introspection & R√©flexion :</strong> Prenez du temps pour vous. C'est un jour pour analyser, m√©diter, et chercher des r√©ponses √† l'int√©rieur. Ne forcez rien.", 8:"<strong>Ambition & Pouvoir :</strong> Concentrez-vous sur vos finances et votre carri√®re. Journ√©e propice aux d√©cisions importantes, aux n√©gociations et √† l'affirmation de votre autorit√©.", 9:"<strong>Bilan & Altruisme :</strong> C'est un jour pour finaliser, pardonner et l√¢cher-prise. Aidez les autres et terminez ce qui est en cours avant de commencer du neuf.", 11: "<strong>Intuition & R√©v√©lation (11/2) :</strong> Une journ√©e de grande sensibilit√©. Fiez-vous √† votre intuition (11), elle est particuli√®rement forte. Les tensions sont possibles, cherchez l'harmonie du 2.", 22: "<strong>Construction & Vision (22/4) :</strong> Potentiel de r√©aliser quelque chose de grand. C'est un jour 4 √† une √©chelle sup√©rieure. R√™vez grand (22), mais ancrez vos actions dans le concret (4).", 33: "<strong>Compassion & Gu√©rison (33/6) :</strong> Journ√©e de service et d'amour universel (33). Une √©nergie de jour 6 amplifi√©e. Soyez une source d'inspiration et de r√©confort pour les autres." },
                compatibility: {
                    relations: { '1': { harmony: [1, 3, 5], challenge: [6, 8], neutral: [2, 4, 7, 9] }, '2': { harmony: [2, 4, 6, 8], challenge: [5, 7], neutral: [1, 3, 9] }, '3': { harmony: [1, 3, 5, 6, 9], challenge: [], neutral: [2, 4, 7, 8] }, '4': { harmony: [2, 4, 6, 8], challenge: [5, 7], neutral: [1, 3, 9] }, '5': { harmony: [1, 3, 5], challenge: [2, 4], neutral: [6, 7, 8, 9] }, '6': { harmony: [2, 3, 4, 6, 9], challenge: [1, 8], neutral: [5, 7] }, '7': { harmony: [7, 9], challenge: [2, 4, 8], neutral: [1, 3, 5, 6] }, '8': { harmony: [2, 4, 6, 8], challenge: [1, 7], neutral: [3, 5, 9] }, '9': { harmony: [3, 6, 9], challenge: [], neutral: [1, 2, 4, 5, 7, 8] }, },
                    summary: { harmony: "Dynamique tr√®s favorable, marqu√©e par une compr√©hension et un soutien mutuels. Les √©nergies s'alignent naturally.", challenge: "Relation de croissance. Les diff√©rences peuvent cr√©er des frictions, mais offrent de puissantes le√ßons si elles sont comprises.", neutral: "Compatibilit√© √©quilibr√©e. La relation d√©pendra de la volont√© des deux partenaires de s'adapter et de communiquer." }
                }
            };

            const calculator = {
                reduceNumber(n, keepMasters = true) {
                    let num = parseInt(n, 10);
                    if (isNaN(num)) return 0;
                    while (num > 9 && (!keepMasters || !data.masterNumbers.includes(num))) {
                        num = String(num).split('').reduce((acc, digit) => acc + parseInt(digit, 10), 0);
                    }
                    return num;
                },
                calculateComplexNumber(sum) {
                    const karmicDebt = Object.keys(data.karmicDebtsMap).map(Number).includes(sum) ? sum : null;
                    const finalValue = this.reduceNumber(sum);
                    let baseValue = null;
                    if(data.masterNumbers.includes(finalValue)) {
                        baseValue = this.reduceNumber(finalValue, false);
                    }
                    return { value: finalValue, karmicDebt, initialSum: sum, baseValue };
                },
                calculateNameNumber(name, type) {
                    if (!name) return { value: 0, initialSum: 0, karmicDebt: null, baseValue: null, details: "Aucun nom fourni" };
                    const normalizedName = name.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase().replace(/[^A-Z\s]/g, '');
                    let sum = 0;
                    let details = [];
                    for (const char of normalizedName) {
                        if (char === ' ') continue;
                        const isVowel = data.vowels.includes(char);
                        if ((type === 'all') || (type === 'vowels' && isVowel) || (type === 'consonants' && !isVowel)) {
                            const value = data.letterValues[char] || 0;
                            sum += value;
                            details.push(`${char}(${value})`);
                        }
                    }
                    if (details.length === 0) return { value: 0, initialSum: 0, karmicDebt: null, baseValue: null, details: "Aucune lettre valide trouv√©e." };
                    const result = this.calculateComplexNumber(sum);
                    result.details = `${details.join(' + ')} = ${result.initialSum}${result.karmicDebt ? ` (Dette ${result.karmicDebt})` : ''} ‚ûî ${result.value}`;
                    return result;
                },
                calculateLifePath(date) {
                    const [year, month, day] = date.split('-');
                    const sum = this.reduceNumber(day, false) + this.reduceNumber(month, false) + this.reduceNumber(year, false);
                    const result = this.calculateComplexNumber(sum);
                    result.details = `Jour(${this.reduceNumber(day, false)}) + Mois(${this.reduceNumber(month, false)}) + Ann√©e(${this.reduceNumber(year, false)}) = ${result.initialSum} ‚ûî ${result.value}`;
                    return result;
                },
                calculateDailyVibration(birthDate) {
                    if (!birthDate) return { value: 0, baseValue: null };
                    const today = new Date();
                    const [year, month, day] = birthDate.split('-').map(Number);
                    const sum = this.reduceNumber(day, false) + this.reduceNumber(month, false) + this.reduceNumber(today.getDate(), false) + this.reduceNumber(today.getMonth() + 1, false) + this.reduceNumber(today.getFullYear(), false);
                    return this.calculateComplexNumber(sum);
                },
                calculateEnergyPresence(fullName) {
                    const presence = { 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0 };
                    const normalizedName = fullName.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase().replace(/[^A-Z]/g, '');
                    for (const char of normalizedName) {
                        if (data.letterValues[char]) {
                            presence[data.letterValues[char]]++;
                        }
                    }
                    return presence;
                },
                calculateLifeCycles(birthDate, lifePathValue) {
                    const [year, month, day] = birthDate.split('-').map(Number);
                    const dayR = this.reduceNumber(day, false), monthR = this.reduceNumber(month, false), yearR = this.reduceNumber(year, false);
                    const age1 = 36 - this.reduceNumber(lifePathValue, false);
                    return [
                        { age: `0 √† ${age1} ans`, pinnacle: this.reduceNumber(monthR + dayR, false), challenge: this.reduceNumber(Math.abs(monthR - dayR), false) },
                        { age: `${age1 + 1} √† ${age1 + 9} ans`, pinnacle: this.reduceNumber(dayR + yearR, false), challenge: this.reduceNumber(Math.abs(dayR - yearR), false) },
                        { age: `${age1 + 10} √† ${age1 + 18} ans`, pinnacle: this.reduceNumber(this.reduceNumber(monthR + dayR, false) + this.reduceNumber(dayR + yearR, false), false), challenge: this.reduceNumber(Math.abs(this.reduceNumber(Math.abs(monthR - dayR), false) - this.reduceNumber(Math.abs(dayR - yearR), false)), false) },
                        { age: `Apr√®s ${age1 + 18} ans`, pinnacle: this.reduceNumber(monthR + yearR, false), challenge: this.reduceNumber(Math.abs(monthR - yearR), false) }
                    ];
                },
                getTheme(fullName, birthDate) {
                    const cleanedFullName = fullName.trim().replace(/\s+/g, ' ');
                    const firstName = cleanedFullName.split(' ')[0];
                    const lifePath = this.calculateLifePath(birthDate);
                    return {
                        fullName: cleanedFullName, firstName, birthDate, lifePath,
                        expression: this.calculateNameNumber(cleanedFullName, 'all'),
                        soul: this.calculateNameNumber(cleanedFullName, 'vowels'),
                        personality: this.calculateNameNumber(cleanedFullName, 'consonants'),
                        active: this.calculateNameNumber(firstName, 'all'),
                        dailyVibration: this.calculateDailyVibration(birthDate),
                        energyPresence: this.calculateEnergyPresence(cleanedFullName),
                        lifeCycles: this.calculateLifeCycles(birthDate, lifePath.value),
                    };
                }
            };

            const ui = {
                elements: {
                    form: document.getElementById('numerology-form'), nameInput: document.getElementById('full-name'), dateInput: document.getElementById('birth-date'),
                    resultsWrapper: document.getElementById('results-wrapper'), dailyVibrationContainer: document.getElementById('daily-vibration-container'),
                    summaryContainer: document.getElementById('summary-container'), energyContainer: document.getElementById('energy-presence-container'),
                    cyclesContainer: document.getElementById('life-cycles-container'), resultsContainer: document.getElementById('results-container'),
                    profileCardContainer: document.getElementById('profile-card-container'), profileCardCanvas: document.getElementById('profile-card-canvas'),
                    printBtn: document.getElementById('print-btn'), aiExportBtn: document.getElementById('ai-export-btn'), profileCardBtn: document.getElementById('profile-card-btn'),
                    themeToggle: document.getElementById('theme-toggle'), welcomeBack: document.getElementById('welcome-back'),
                    navTheme: document.getElementById('nav-theme'), navCompatibility: document.getElementById('nav-compatibility'),
                    themeContent: document.getElementById('theme-content'), compatibilityContent: document.getElementById('compatibility-content'),
                    compatForm: document.getElementById('compatibility-form'), p1Name: document.getElementById('p1-full-name'), p1Date: document.getElementById('p1-birth-date'),
                    p2Name: document.getElementById('p2-full-name'), p2Date: document.getElementById('p2-birth-date'), compatResultsContainer: document.getElementById('compatibility-results'),
                    glossaryModal: document.getElementById('glossary-modal'), modalCloseBtn: document.getElementById('modal-close-btn'), modalBody: document.getElementById('modal-body'),
                    methodologyModal: document.getElementById('methodology-modal'), methodologyCloseBtn: document.getElementById('methodology-close-btn'), methodologyModalBody: document.getElementById('methodology-modal-body'), methodologyLink: document.getElementById('methodology-link'),
                },

                init() {
                    this.elements.themeToggle.addEventListener('change', () => { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light'); });
                    if (localStorage.getItem('theme') === 'dark') { document.body.classList.add('dark-mode'); this.elements.themeToggle.checked = true; }
                    
                    this.elements.navTheme.addEventListener('click', () => this.toggleView('theme'));
                    this.elements.navCompatibility.addEventListener('click', () => this.toggleView('compatibility'));
                    
                    this.elements.form.addEventListener('submit', e => { e.preventDefault(); this.handleThemeSubmit(); });
                    this.elements.compatForm.addEventListener('submit', e => { e.preventDefault(); this.handleCompatibilitySubmit(e); });
                    
                    [this.elements.dateInput, this.elements.p1Date, this.elements.p2Date].forEach(input => { input.addEventListener('input', this.formatDateInput); });
                    
                    const savedUser = JSON.parse(localStorage.getItem('numerologyUser'));
                    if (savedUser && savedUser.name && savedUser.date) {
                        this.elements.nameInput.value = savedUser.name;
                        this.elements.dateInput.value = this.formatDateForDisplay(savedUser.date);
                        this.elements.p1Name.value = savedUser.name;
                        this.elements.p1Date.value = this.formatDateForDisplay(savedUser.date);
                        this.elements.welcomeBack.innerHTML = `Heureux de vous revoir, ${savedUser.name.split(' ')[0]} !`;
                        this.elements.welcomeBack.classList.remove('hidden');
                        this.displayThemeResults(savedUser.name, savedUser.date, true);
                    }

                    this.elements.modalCloseBtn.onclick = () => this.elements.glossaryModal.style.display = "none";
                    this.elements.methodologyCloseBtn.onclick = () => this.elements.methodologyModal.style.display = "none";
                    this.elements.methodologyLink.onclick = () => this.openMethodologyModal();
                    
                    window.onclick = (event) => {
                        if (event.target == this.elements.glossaryModal) this.elements.glossaryModal.style.display = "none";
                        if (event.target == this.elements.methodologyModal) this.elements.methodologyModal.style.display = "none";
                    };
                },
                
                formatNumberForDisplay(result) {
                    if (result && result.baseValue) { return `${result.value}/${result.baseValue}`; }
                    return result ? result.value : '';
                },

                generateCircleHTML(result) {
                    if (result && result.baseValue) {
                        return `<span class="master-part">${result.value}</span><hr class="separator"><span class="base-part">${result.baseValue}</span>`;
                    }
                    return result ? result.value : '';
                },

                parseAndValidateDate(dateString) {
                    const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/; if (!regex.test(dateString)) return null;
                    const [, day, month, year] = dateString.match(regex);
                    const date = new Date(`${year}-${month}-${day}T00:00:00`);
                    if (date.getFullYear() != year || (date.getMonth() + 1) != month || date.getDate() != day) return null;
                    return `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
                },

                formatDateForDisplay(dateString) { if (!dateString) return ''; const [year, month, day] = dateString.split('-'); return `${day}/${month}/${year}`; },
                formatDateInput(e) { let input = e.target; let value = input.value.replace(/\D/g, ''); if (value.length > 2) value = value.slice(0, 2) + '/' + value.slice(2); if (value.length > 5) value = value.slice(0, 5) + '/' + value.slice(5, 9); input.value = value; },
                
                toggleView(view) {
                    const isTheme = view === 'theme';
                    this.elements.themeContent.classList.toggle('active', isTheme);
                    this.elements.compatibilityContent.classList.toggle('active', !isTheme);
                    this.elements.navTheme.classList.toggle('active', isTheme);
                    this.elements.navCompatibility.classList.toggle('active', !isTheme);
                },

                handleThemeSubmit() {
                    const fullName = this.elements.nameInput.value; const birthDate = this.parseAndValidateDate(this.elements.dateInput.value);
                    if (!fullName || !birthDate) { alert("Veuillez remplir tous les champs, avec une date valide au format JJ/MM/AAAA."); return; }
                    localStorage.setItem('numerologyUser', JSON.stringify({ name: fullName, date: birthDate }));
                    this.displayThemeResults(fullName, birthDate, false);
                    this.elements.p1Name.value = fullName; this.elements.p1Date.value = this.formatDateForDisplay(birthDate);
                },
                
                handleCompatibilitySubmit(e){
                    const p1Name = this.elements.p1Name.value; const p1Date = this.parseAndValidateDate(this.elements.p1Date.value);
                    const p2Name = this.elements.p2Name.value; const p2Date = this.parseAndValidateDate(this.elements.p2Date.value);
                    if(!p1Name || !p1Date || !p2Name || !p2Date) { alert("Veuillez remplir les informations des deux personnes, avec des dates valides au format JJ/MM/AAAA."); return; }
                    const p1Theme = calculator.getTheme(p1Name, p1Date); const p2Theme = calculator.getTheme(p2Name, p2Date);
                    this.displayCompatibilityResults(p1Theme, p2Theme); e.target.querySelector('button').scrollIntoView({ behavior: 'smooth', block: 'end' });
                },

                displayThemeResults(fullName, birthDate, isReload) {
                    const theme = calculator.getTheme(fullName, birthDate);
                    const mainResults = new Map([
                        ['Chemin de Vie', { key: 'cheminDeVie', result: theme.lifePath, description: "Votre mission de vie, les grandes le√ßons √† apprendre et le potentiel √† r√©aliser." }],
                        ['Nombre d\'Expression', { key: 'expression', result: theme.expression, description: "Vos talents et potentiels inn√©s. Ce sont vos outils pour naviguer la vie." }],
                        ['Nombre de l\'√Çme', { key: 'ame', result: theme.soul, description: "Vos d√©sirs profonds, ce qui vous motive et vous anime de l'int√©rieur." }],
                        ['Nombre de Personnalit√©', { key: 'personnalite', result: theme.personality, description: "L'image que vous projetez, la premi√®re impression que les autres ont de vous." }],
                        ['Nombre Actif', { key: 'nombreActif', result: theme.active, description: "Votre √©nergie d'action, la fa√ßon dont vous initiez les choses." }]
                    ]);
                    
                    this.displayDailyVibration(theme.dailyVibration);
                    this.displaySummary(theme.lifePath, theme.expression);
                    this.displayEnergyChart(theme.energyPresence);
                    this.displayLifeCycles(theme.lifeCycles);

                    this.elements.resultsContainer.innerHTML = '';
                    mainResults.forEach((resultData, title) => { this.elements.resultsContainer.appendChild(this.createResultCard(title, resultData)); });
                    
                    this.elements.resultsWrapper.classList.remove('hidden');
                    this.animateCards('#theme-content .card');
                    if (!isReload) { setTimeout(() => this.elements.resultsWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' }), 200); }
                    this.setupActionButtons(theme, mainResults);
                },
                
                createResultCard(title, resultData) {
                    const interpretationText = data.interpretations[resultData.key]?.[resultData.result.value] || "Interpr√©tation non disponible.";
                    const card = document.createElement('div');
                    card.className = 'card result-card';
                    const circleHTML = this.generateCircleHTML(resultData.result);
                    let karmicHTML = '';
                    if(resultData.result.karmicDebt) {
                        karmicHTML = `<div class="karmic-warning">‚ö†Ô∏è <strong>D√©fi Karmique ${resultData.result.karmicDebt} :</strong> Ce nombre indique un d√©fi sp√©cifique, un 'frein' √† transformer en force, li√© √† ${data.karmicDebtsMap[resultData.result.karmicDebt]}.</div>`;
                    }
                    let methodologyNoteHTML = '';
                    if(title === 'Nombre de l\'√Çme') {
                        methodologyNoteHTML = `<p class="methodology-note">‚ÑπÔ∏è Calcul√© avec les voyelles du nom complet (A, E, I, O, U, Y). Voir "Notre M√©thodologie" en bas de page pour plus de d√©tails.</p>`;
                    }
                    card.innerHTML = `<h2><span class="number-circle" data-number="${resultData.result.value}">${circleHTML}</span>${title}</h2><p class="description">${resultData.description}</p><p>${interpretationText}</p>${karmicHTML}<details><summary>Voir le calcul</summary><div class="calculation-details" style="font-size:0.9em; opacity:0.8; padding-top:10px;">${resultData.result.details}</div></details>${methodologyNoteHTML}`;
                    card.querySelector('.number-circle').addEventListener('click', (e) => this.openGlossaryModal(e.currentTarget.dataset.number));
                    return card;
                },

                displayDailyVibration(vibration) {
                    const circleHTML = this.generateCircleHTML(vibration);
                    this.elements.dailyVibrationContainer.innerHTML = `<div class="card daily-vibration-card"><h2 class="fade-in"><span class="number-circle" data-number="${vibration.value}">${circleHTML}</span>Votre Vibration du Jour</h2><p class="description fade-in">${data.dailyVibration[vibration.value] || "Journ√©e d'√©nergie intense et de potentiel √©lev√©."}</p></div>`;
                    this.elements.dailyVibrationContainer.querySelector('.number-circle').addEventListener('click', (e) => this.openGlossaryModal(e.currentTarget.dataset.number));
                },
                
                displaySummary(lifePath, expression) {
                    const lpDisplay = this.formatNumberForDisplay(lifePath);
                    const expDisplay = this.formatNumberForDisplay(expression);
                    const lpText = data.interpretations.cheminDeVie[lifePath.value]?.match(/<strong>(.*?) :<\/strong>/)[1] || "inconnu";
                    const expText = data.interpretations.expression[expression.value]?.match(/<strong>(.*?) :<\/strong>/)[1] || "inconnu";
                    let summaryText = `La cl√© de votre √©panouissement r√©side dans la relation entre votre <strong>mission de vie (Chemin de Vie ${lpDisplay})</strong> et vos <strong>outils inn√©s (Nombre d'Expression ${expDisplay})</strong>.<br><br>Votre mission est de devenir <strong>${lpText}</strong>. Pour y parvenir, vous disposez naturellement des talents d'un(e) <strong>${expText}</strong>. L'art consiste √† utiliser consciemment vos outils pour avancer sur votre chemin.`;
                    
                    if (lifePath.value === expression.value || (lifePath.baseValue && lifePath.baseValue === expression.value)) {
                        summaryText += "<br><br>‚ú® <strong>Synergie Puissante :</strong> Votre mission et vos talents sont en alignement parfait. Cela vous donne une grande force et une clart√© d'objectif, mais attention √† ne pas rester dans votre zone de confort.";
                    } else {
                        summaryText += "<br><br>üí° <strong>Dynamique de Croissance :</strong> Vos outils et votre mission sont diff√©rents. Cette tension est votre plus grande force : elle vous pousse √† d√©velopper de nouvelles facettes de votre personnalit√© pour atteindre votre plein potentiel.";
                    }
                    this.elements.summaryContainer.innerHTML = `<div class="card summary-card" style="border-left-color: var(--summary-border);"><h2>‚ú® Votre Duo Strat√©gique</h2><p>${summaryText}</p></div>`;
                },

                displayEnergyChart(presenceData) {
                    const analysis = this.generateEnergyAnalysis(presenceData);
                    const container = this.elements.energyContainer;
                    const chartWidth = 400; const chartHeight = 170;
                    const barWidth = 30; const barMargin = 15;
                    let maxPresence = Math.max(...Object.values(presenceData));
                    if (maxPresence === 0) maxPresence = 1;
                    let svgContent = `<svg width="100%" viewBox="0 0 ${chartWidth} ${chartHeight}" preserveAspectRatio="xMidYMid meet">`;
                    Object.entries(presenceData).forEach(([num, count], index) => {
                        const barHeight = (count / maxPresence) * (chartHeight - 30);
                        const x = index * (barWidth + barMargin);
                        const y = chartHeight - barHeight - 20;
                        svgContent += `<g transform="translate(${x}, 0)"><rect x="0" y="${y}" width="${barWidth}" height="${barHeight}" fill="var(--secondary-color)" rx="3"><title>${data.energyKeywords[num]} (pr√©sent ${count} fois)</title></rect><text x="${barWidth / 2}" y="${chartHeight - 5}" font-family="Poppins" font-size="12" fill="var(--text-color)" text-anchor="middle">${num}</text></g>`;
                    });
                    svgContent += `</svg>`;
                    container.innerHTML = `<div class="card chart-card"><h2 style="font-size: 1.5em;">üìä Vos √ânergies Inn√©es (dans le nom)</h2><p class="description">Ce graphique r√©v√®le vos forces naturelles (barres hautes) et vos axes de d√©veloppement (barres basses ou absentes).</p><div class="energy-chart-svg-container">${svgContent}</div>${analysis}</div>`;
                },

                generateEnergyAnalysis(presenceData) {
                    const maxCount = Math.max(...Object.values(presenceData));
                    if (maxCount === 0) return "";
                    const maxEnergies = Object.keys(presenceData).filter(k => presenceData[k] === maxCount).map(Number);
                    const lackingEnergies = Object.keys(presenceData).filter(k => presenceData[k] === 0).map(Number);
                    let analysisHTML = '<div class="energy-analysis"><p><strong>Analyse de votre potentiel :</strong> ';
                    analysisHTML += `Vos √©nergies dominantes sont le <strong>${maxEnergies.map(n => `${n} (${data.energyKeywords[n]})`).join(' et le ')}</strong>. Ce sont vos talents les plus √©vidents, des forces sur lesquelles vous pouvez vous appuyer. `;
                    if (lackingEnergies.length > 0) {
                        analysisHTML += `√Ä l'inverse, les √©nergies <strong>${lackingEnergies.map(n => `${n} (${data.energyKeywords[n]})`).join(', ')}</strong> sont vos <strong>axes de croissance</strong>. Int√©grer consciemment ces qualit√©s dans votre vie vous aidera √† surmonter certains blocages et √† trouver un meilleur √©quilibre.`;
                    }
                    analysisHTML += '</p></div>';
                    return analysisHTML;
                },

                displayLifeCycles(cyclesData) {
                    let cyclesHTML = `<div class="card cycles-card"><h2 style="font-size: 1.5em;">üß≠ Vos 4 Cycles de Vie</h2><p class="description">Votre vie se divise en grands cycles, chacun avec une ambiance (Pinacle) et une le√ßon √† int√©grer (D√©fi).</p><div class="life-cycles-grid">`;
                    cyclesData.forEach(cycle => { cyclesHTML += `<div class="cycle-card"><h3>${cycle.age}</h3><p><strong>Pinacle ${cycle.pinnacle}:</strong> Opportunit√©s et climat.</p><p><strong>D√©fi ${cycle.challenge}:</strong> Le√ßon √† ma√Ætriser.</p></div>`; });
                    cyclesHTML += `</div></div>`;
                    this.elements.cyclesContainer.innerHTML = cyclesHTML;
                },
                
                getCompatibility(n1, n2) {
                    const r1 = calculator.reduceNumber(n1, false);
                    const r2 = calculator.reduceNumber(n2, false);
                    const rel = data.compatibility.relations[r1];
                    if (!rel) return 'neutral';
                    if (rel.harmony.includes(r2)) return 'harmony';
                    if (rel.challenge.includes(r2)) return 'challenge';
                    return 'neutral';
                },

                displayCompatibilityResults(p1, p2) {
                    const container = this.elements.compatResultsContainer;
                    container.innerHTML = '';
                    const aspects = [
                        { title: 'Chemins de Vie (Missions)', res1: p1.lifePath, res2: p2.lifePath, desc: "La mission de vie, la le√ßon principale." },
                        { title: 'Nombres d\'Expression (Outils)', res1: p1.expression, res2: p2.expression, desc: "Les talents, le mode de fonctionnement." },
                        { title: 'Nombres d\'√Çme (D√©sirs)', res1: p1.soul, res2: p2.soul, desc: "Les d√©sirs profonds, les motivations intimes." }
                    ];
                    aspects.forEach(aspect => {
                        const type = this.getCompatibility(aspect.res1.value, aspect.res2.value);
                        const typeText = { harmony: 'Harmonie', challenge: 'D√©fi', neutral: 'Neutre' }[type];
                        const card = document.createElement('div');
                        card.className = `card ${type}`;
                        const p1Display = this.formatNumberForDisplay(aspect.res1);
                        const p2Display = this.formatNumberForDisplay(aspect.res2);
                        card.innerHTML = `<h2 style="color: var(--${type}-color);">${typeText} - ${aspect.title}</h2><p><strong>${p1.firstName} (${p1Display}) & ${p2.firstName} (${p2Display})</strong></p><p><em>${aspect.desc}</em></p><p>${data.compatibility.summary[type]}</p>`;
                        container.appendChild(card);
                    });
                    container.classList.remove('hidden');
                    this.animateCards('#compatibility-results .card');
                },
                
                openGlossaryModal(number) {
                    let html = `<h2>L'√ânergie du Nombre ${number}</h2>`;
                    html += `<p><strong>Mot-cl√© :</strong> ${data.energyKeywords[number]}</p><hr>`;
                    Object.keys(data.interpretations).forEach(key => {
                        if (data.interpretations[key][number]) {
                            const title = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                            html += `<h3>En ${title} :</h3><p>${data.interpretations[key][number].split('. ')[0].replace(/<strong>.*?<\/strong> /,'')}</p>`;
                        }
                    });
                    this.elements.modalBody.innerHTML = html;
                    this.elements.glossaryModal.style.display = "block";
                },

                openMethodologyModal() {
                    const { title, content } = data.methodologyText;
                    this.elements.methodologyModalBody.innerHTML = `<h2>${title}</h2>${content}`;
                    this.elements.methodologyModal.style.display = "block";
                },

                drawProfileCard(theme) {
                    this.elements.profileCardContainer.classList.remove('hidden');
                    const canvas = this.elements.profileCardCanvas; const ctx = canvas.getContext('2d');
                    const isDark = document.body.classList.contains('dark-mode');
                    canvas.width = 500; canvas.height = 500;
                    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                    gradient.addColorStop(0, isDark ? '#2c3e50' : '#4361ee');
                    gradient.addColorStop(1, isDark ? '#1e1e1e' : '#7209b7');
                    ctx.fillStyle = gradient; ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'white'; ctx.font = 'bold 32px Lora'; ctx.textAlign = 'center';
                    ctx.fillText(theme.firstName, canvas.width / 2, 80);
                    const numbers = [ { label: "Chemin de Vie", result: theme.lifePath }, { label: "Expression", result: theme.expression }, { label: "√Çme", result: theme.soul }, { label: "Personnalit√©", result: theme.personality } ];
                    ctx.font = '22px Poppins';
                    numbers.forEach((num, index) => {
                        const y = 160 + index * 80;
                        const displayNumber = this.formatNumberForDisplay(num.result);
                        ctx.textAlign = 'left'; ctx.fillText(`${num.label} :`, 100, y);
                        ctx.textAlign = 'right'; ctx.font = 'bold 38px Lora';
                        ctx.fillText(displayNumber, 400, y + 10);
                        ctx.font = '22px Poppins';
                    });
                    this.elements.profileCardContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                },

                animateCards(selector) {
                    document.querySelectorAll(selector).forEach((card, index) => {
                        card.classList.remove('fade-in'); void card.offsetWidth;
                        card.style.animationDelay = `${index * 0.07}s`;
                        card.classList.add('fade-in');
                    });
                },

                setupActionButtons(theme, resultsMap) {
                    this.elements.printBtn.onclick = () => window.print();
                    this.elements.profileCardBtn.onclick = () => this.drawProfileCard(theme);

                    this.elements.aiExportBtn.innerHTML = '‚ú® R√©v√©ler mon Analyse Strat√©gique Compl√®te';
                    let existingDesc = this.elements.aiExportBtn.nextElementSibling;
                    if(existingDesc && existingDesc.classList.contains('ai-prompt-description')) {
                        existingDesc.remove();
                    }
                    const aiDesc = document.createElement('p');
                    aiDesc.className = 'ai-prompt-description';
                    aiDesc.innerHTML = "Copie un prompt optimis√© √† coller dans une IA (ChatGPT, Gemini, etc.) pour une analyse qui tisse des liens entre tous vos nombres.";
                    this.elements.aiExportBtn.insertAdjacentElement('afterend', aiDesc);
                    
                    this.elements.aiExportBtn.onclick = () => {
                        let resultsForAI = '';
                        resultsMap.forEach((data, title) => {
                            const displayNumber = this.formatNumberForDisplay(data.result);
                            resultsForAI += `${title}: ${displayNumber}${data.result.karmicDebt ? ` (Dette Karmique ${data.result.karmicDebt})` : ''}\n`;
                        });
                        const aiPrompt = `# CONTEXTE\nAgis comme un expert en num√©rologie strat√©gique. Analyse le th√®me suivant.\n\n# TH√àME NUM√âROLOGIQUE\n${resultsForAI.trim()}\n\n# CYCLES DE VIE\n${JSON.stringify(theme.lifeCycles, null, 2)}\n\n# √âNERGIES DU NOM (Pr√©sence des nombres de 1 √† 9)\n${JSON.stringify(theme.energyPresence, null, 2)}\n\n# TA MISSION\nEn te basant sur TOUTES ces donn√©es, r√©dige une analyse compl√®te et bienveillante. Ta valeur est de TISSER DES LIENS entre les nombres pour r√©v√©ler les synergies, les d√©fis et le potentiel global. Prends en compte la vibration compl√®te des ma√Ætres nombres (ex: la dualit√© travail/vision du 22/4).\n\nStructure ta r√©ponse ainsi :\n1. **Synth√®se Strat√©gique (Le Duo Cl√©) :** Explique la dynamique centrale entre le Chemin de Vie (la mission) et le Nombre d'Expression (les outils). Comment ces deux nombres interagissent-ils ? Est-ce une synergie ou un d√©fi de croissance ?\n2. **Forces Principales & Potentiel :** Identifie 2-3 associations positives entre les diff√©rents nombres (ex: √Çme et Personnalit√© align√©es, √©nergies dominantes du nom qui soutiennent le Chemin de Vie). Explique comment exploiter ce potentiel.\n3. **Axes de Croissance (D√©fis & Freins) :** Analyse les tensions, les dettes karmiques et les √©nergies manquantes du nom. Donne un conseil concret pour transformer chaque d√©fi en une opportunit√© de croissance.\n4. **Feuille de Route pour la P√©riode Actuelle :** En se basant sur le cycle de vie actuel (consid√©rer que nous sommes en ${new Date().getFullYear()}), quel est le principal conseil pour la p√©riode que la personne traverse ?\n5. **Conseil Final :** R√©sume le potentiel unique de cette personne en une phrase puissante et donne un conseil final actionnable.`;
                        navigator.clipboard.writeText(aiPrompt.trim()).then(() => { 
                            const originalText = this.elements.aiExportBtn.innerHTML; 
                            this.elements.aiExportBtn.innerHTML = '‚úÖ Copi√© dans le presse-papiers !'; 
                            this.elements.aiExportBtn.disabled = true; 
                            setTimeout(() => { this.elements.aiExportBtn.innerHTML = originalText; this.elements.aiExportBtn.disabled = false; }, 2500); 
                        });
                    };
                }
            };
            ui.init();
        });
    </script>
</body>
</html>

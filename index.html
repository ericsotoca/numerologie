<!DOCTYPE html>
<!-- D√©claration du type de document et de la langue principale (Fran√ßais) pour l'accessibilit√© et le SEO. -->
<html lang="fr">
<head>
    <!-- M√©ta-informations essentielles pour le navigateur et les moteurs de recherche. -->
    <meta charset="UTF-8"> <!-- Sp√©cifie l'encodage des caract√®res en UTF-8 pour une compatibilit√© maximale. -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Assure un affichage responsive sur les appareils mobiles. -->
    <title>Num√©rologie Strat√©gique - Grand Ma√Ætre</title> <!-- Titre affich√© dans l'onglet du navigateur. -->
    
    <!-- Pr√©-connexion aux serveurs de Google Fonts pour un chargement plus rapide des polices. -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Importation des polices personnalis√©es 'Lora' (serif, pour les titres) et 'Poppins' (sans-serif, pour le corps du texte). -->
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

    <!-- Section des styles CSS pour la mise en page et l'apparence de l'application. -->
    <style>
        /*
         * D√âFINITION DES VARIABLES CSS (CUSTOM PROPERTIES)
         * L'utilisation de variables permet une gestion centralis√©e des couleurs et des styles.
         * Changer une variable ici met √† jour toute l'application, facilitant la maintenance et le theming (mode clair/sombre).
        */
        :root {
            /* Palette de couleurs principale (Th√®me Clair) */
            --primary-color: #3a0ca3;         /* Couleur principale pour les titres et les accents forts. */
            --secondary-color: #7209b7;       /* Couleur secondaire pour les cercles de nombres et les d√©grad√©s. */
            --background-color: #f5f3f4;      /* Couleur de fond g√©n√©rale de la page. */
            --text-color: #212529;            /* Couleur du texte par d√©faut pour une bonne lisibilit√©. */
            --card-bg: #ffffff;               /* Couleur de fond des cartes de contenu. */
            --border-radius: 12px;            /* Rayon de bordure standard pour un look moderne et doux. */
            --box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08); /* Ombre port√©e pour donner de la profondeur aux √©l√©ments. */
            
            /* Couleurs sp√©cifiques pour des composants UI */
            --summary-border: #4361ee;        /* Couleur de la bordure pour la carte de synth√®se. */
            --karmic-bg: #fffbe6;             /* Fond pour les avertissements karmiques. */
            --karmic-border: #ffc107;         /* Bordure pour les avertissements karmiques. */
            --daily-vibration-bg: linear-gradient(135deg, #fbc2eb 0%, #a6c1ee 100%); /* D√©grad√© pour la vibration du jour. */

            /* Couleurs pour l'analyse de compatibilit√© */
            --harmony-color: #2a9d8f;         /* Vert pour les relations harmonieuses. */
            --challenge-color: #e76f51;       /* Orange/Rouge pour les relations de d√©fi. */
            --neutral-color: #f4a261;         /* Jaune/Orange pour les relations neutres. */
        }

        /* Red√©finition des variables pour le mode sombre (dark-mode) */
        body.dark-mode {
            --primary-color: #9d4edd;
            --secondary-color: #c77dff;
            --background-color: #121212; /* Un noir profond mais pas absolu pour un meilleur confort visuel. */
            --text-color: #e0e0e0;       /* Un gris clair pour le texte, moins agressif que le blanc pur. */
            --card-bg: #1e1e1e;           /* Un gris fonc√© pour les cartes, cr√©ant un contraste subtil. */
            --box-shadow: 0 6px 20px rgba(255, 255, 255, 0.05);
            --summary-border: #80ffdb;
            --karmic-bg: #332b00;
            --karmic-border: #ffc107;
            --daily-vibration-bg: linear-gradient(135deg, #2d1a3c 0%, #2c3e50 100%);
            --harmony-color: #80ffdb;
            --challenge-color: #ff9b85;
            --neutral-color: #ffcb77;
        }

        /* Animation d'apparition subtile pour les √©l√©ments de contenu. */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* STYLES G√âN√âRAUX */
        html { scroll-behavior: smooth; } /* Permet un d√©filement fluide lors des clics sur les ancres. */
        body {
            font-family: 'Poppins', sans-serif; /* Police par d√©faut pour le corps du texte. */
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex; /* Utilisation de flexbox pour centrer le conteneur principal. */
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s; /* Transition douce pour le changement de th√®me. */
        }
        .container { max-width: 800px; width: 100%; }

        /* STRUCTURE & MISE EN PAGE */
        header { text-align: center; margin-bottom: 20px; color: var(--primary-color); position: relative; }
        header h1 { font-family: 'Lora', serif; font-size: 2.5em; font-weight: 600; margin: 0; }
        
        /* Navigation par onglets (Mon Th√®me / Compatibilit√©) */
        nav.app-nav { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 15px;}
        nav.app-nav button { padding: 10px 20px; font-size: 1em; background: transparent; color: var(--text-color); border: 2px solid transparent; border-radius: var(--border-radius); font-weight: 600; cursor: pointer; transition: all 0.2s ease; }
        nav.app-nav button.active { /* Style pour l'onglet actif */
            color: var(--primary-color); 
            border-bottom: 2px solid var(--primary-color);
            background-color: color-mix(in srgb, var(--primary-color) 10%, transparent); /* Fond subtil pour l'onglet actif. */
        }
        
        /* Gestion de l'affichage des onglets */
        .tab-content { display: none; } /* Par d√©faut, les contenus des onglets sont cach√©s. */
        .tab-content.active { display: block; animation: fadeIn 0.5s; } /* L'onglet actif est affich√© avec une animation. */
        
        main { background: var(--card-bg); padding: 30px 40px; border-radius: var(--border-radius); box-shadow: var(--box-shadow); transition: background-color 0.3s; }
        #welcome-back { padding: 15px; background-color: color-mix(in srgb, var(--summary-border) 20%, transparent); border: 1px solid var(--summary-border); color: var(--text-color); border-radius: var(--border-radius); margin-bottom: 20px; text-align: center; font-weight: 600; }
        .interpretation-details ul { padding-left: 20px; }
        .interpretation-details li { margin-bottom: 8px; }
        
        /* FORMULAIRES & BOUTONS */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-color); }
        .input-group input { 
            width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: var(--border-radius); 
            font-size: 1em; font-family: 'Poppins', sans-serif; box-sizing: border-box; /* Essentiel pour que le padding n'affecte pas la largeur totale. */
            background-color: var(--card-bg); color: var(--text-color); 
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        button { 
            width: 100%; padding: 15px; 
            background: linear-gradient(45deg, var(--secondary-color), var(--primary-color));
            color: white; border: none; border-radius: var(--border-radius);
            font-size: 1.2em; font-weight: 600; cursor: pointer; transition: all 0.2s; 
        }
        button:hover:not(:disabled) { /* Effet de survol pour les boutons actifs */
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(58, 12, 163, 0.4); 
        }
        button:disabled { background: #999; cursor: not-allowed; transform: translateY(0); box-shadow: none; }

        /* CARTES DE R√âSULTATS */
        .card { 
            opacity: 0; /* Initialement invisible pour l'animation d'apparition. */
            background-color: var(--card-bg); padding: 25px; margin-bottom: 25px; 
            border-radius: var(--border-radius); border-left: 6px solid var(--secondary-color); 
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); 
        }
        .card.fade-in { animation: fadeIn 0.5s ease-out forwards; } /* 'forwards' maintient l'√©tat final de l'animation. */
        h2 { margin-top: 0; margin-bottom: 15px; color: var(--primary-color); display: flex; align-items: center; font-family: 'Lora', serif; font-size: 1.8em; }

        /* CERCLE DE NOMBRE (√âl√©ment visuel central) */
        .number-circle {
            flex-shrink: 0; /* Emp√™che le cercle de se r√©duire si le titre est trop long. */
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            width: 70px; height: 70px; background-color: var(--secondary-color); color: white; border-radius: 50%;
            font-weight: 700; margin-right: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            cursor: pointer; transition: transform 0.2s; box-sizing: border-box;
            font-size: 2.5em; /* Taille par d√©faut pour les nombres √† un chiffre. */
        }
        .number-circle:hover { transform: scale(1.1); } /* Agrandissement au survol. */
        /* Styles sp√©cifiques pour les Ma√Ætres Nombres (ex: 22/4) */
        .number-circle .master-part { font-size: 1.7rem; line-height: 1.1; }
        .number-circle .separator { width: 65%; margin: 2px 0; border: none; border-top: 2px solid rgba(255, 255, 255, 0.75); }
        .number-circle .base-part { font-size: 1.4rem; line-height: 1; opacity: 0.9; }

        /* STYLES SP√âCIFIQUES DES COMPOSANTS */
        .daily-vibration-card { border: none; background: var(--daily-vibration-bg); color: #fff; }
        .daily-vibration-card h2, .daily-vibration-card .description, body.dark-mode .daily-vibration-card p { color: #fff; } /* Assure la lisibilit√© du texte sur le fond d√©grad√©. */
        
        .karmic-warning { background-color: var(--karmic-bg); border: 1px solid var(--karmic-border); border-radius: var(--border-radius); padding: 15px; margin-top: 20px; color: color-mix(in srgb, var(--karmic-border) 80%, #000 20%);}
        .methodology-note { font-size: 0.8em; opacity: 0.7; margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee; }
        
        .action-buttons { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
        .action-buttons button { flex: 1 1 200px; } /* Les boutons s'adaptent √† la largeur disponible. */
        .ai-prompt-description { font-size: 0.85em; opacity: 0.8; margin: 8px 0 0 0; text-align: center; color: var(--text-color); width: 100%; }

        /* MODALE (POP-UP) */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); animation: fadeIn 0.3s; }
        .modal-content { background-color: var(--card-bg); margin: 10% auto; padding: 30px; border-top: 5px solid var(--primary-color); width: 80%; max-width: 600px; border-radius: var(--border-radius); position: relative; }
        .close-button { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .hidden { display: none !important; } /* Classe utilitaire pour cacher des √©l√©ments. */

        /* INTERRUPTEUR DE TH√àME (THEME SWITCHER) */
        .theme-switch-wrapper { display: flex; align-items: center; position: absolute; top: 15px; right: 15px; }
        .theme-switch { position: relative; display: inline-block; width: 60px; height: 34px; }
        .theme-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 26px; width: 26px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--primary-color); }
        input:checked + .slider:before { transform: translateX(26px); }

        /* STYLES POUR LA PAGE DE COMPATIBILIT√â */
        #compatibility-results .card { border-left-width: 6px; }
        #compatibility-results .card.harmony { border-left-color: var(--harmony-color); }
        #compatibility-results .card.challenge { border-left-color: var(--challenge-color); }
        #compatibility-results .card.neutral { border-left-color: var(--neutral-color); }
        
        /* GRAPHIQUE DES √âNERGIES & CYCLES DE VIE */
        .energy-chart-svg-container { margin-top: 15px; }
        .energy-analysis { margin-top: 15px; padding: 15px; background-color: color-mix(in srgb, var(--primary-color) 5%, transparent); border-radius: var(--border-radius); }
        .life-cycles-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; } /* Grille responsive pour les cycles de vie. */
        .cycle-card { padding: 15px; border-radius: var(--border-radius); background-color: color-mix(in srgb, var(--primary-color) 5%, transparent); text-align: center; }
        .cycle-card h3 { font-family: 'Lora', serif; color: var(--primary-color); margin-top: 0; }
        
        footer a { color: var(--primary-color); text-decoration: none; font-weight: 600; cursor: pointer; }
    </style>
</head>
<body>
    <!-- Le conteneur principal qui centre le contenu sur la page. -->
    <div class="container">
        
        <!-- En-t√™te de l'application avec le titre principal et le s√©lecteur de th√®me. -->
        <header>
            <h1>üîÆ Num√©rologie - Grand Ma√Ætre</h1>
            <div class="theme-switch-wrapper">
                <label class="theme-switch" for="theme-toggle"><input type="checkbox" id="theme-toggle" /><span class="slider round"></span></label>
            </div>
        </header>
        
        <!-- Barre de navigation principale pour basculer entre les sections de l'application. -->
        <nav class="app-nav">
            <button id="nav-theme" class="active">Mon Th√®me</button>
            <button id="nav-compatibility">Compatibilit√©</button>
        </nav>

        <!-- Contenu principal de l'application. -->
        <main>
            <!-- Onglet 1 : Calcul du th√®me personnel. Il est actif par d√©faut. -->
            <div id="theme-content" class="tab-content active">
                <!-- Message de bienvenue pour les utilisateurs r√©currents, cach√© par d√©faut. -->
                <div id="welcome-back" class="hidden"></div>

                <!-- Formulaire pour entrer les donn√©es de l'utilisateur. -->
                <form id="numerology-form">
                    <div class="input-group"><label for="full-name">Vos Noms & Pr√©noms (de naissance)</label><input type="text" id="full-name" required></div>
                    <div class="input-group">
                        <label for="birth-date">Votre Date de naissance</label>
                        <input type="text" id="birth-date" required placeholder="JJ/MM/AAAA" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}">
                    </div>
                    <button type="submit">Calculer mon Th√®me Complet</button>
                </form>

                <!-- Conteneur pour tous les r√©sultats, initialement cach√©. -->
                <div id="results-wrapper" class="hidden">
                    <div id="daily-vibration-container"></div> <!-- Pour la vibration du jour. -->
                    <div id="summary-container"></div>         <!-- Pour la synth√®se strat√©gique. -->
                    <div id="results-container"></div>         <!-- Pour les nombres principaux. -->
                    <div id="energy-presence-container"></div>  <!-- Pour le graphique des √©nergies. -->
                    <div id="life-cycles-container"></div>      <!-- Pour les cycles de vie. -->
                    <!-- Conteneur pour la carte de profil g√©n√©r√©e, cach√©e par d√©faut. -->
                    <div id="profile-card-container" class="hidden"><h2>üñºÔ∏è Votre Carte de Profil</h2><p>Faites un clic droit sur l'image pour la sauvegarder.</p><canvas id="profile-card-canvas"></canvas></div>
                    <!-- Boutons d'action pour exporter, imprimer, etc. -->
                    <div class="action-buttons">
                        <button id="ai-export-btn">‚ú® Analyser avec une IA</button>
                        <button id="profile-card-btn">üñºÔ∏è Cr√©er ma Carte</button>
                        <button id="print-btn">üñ®Ô∏è Imprimer / PDF</button>
                    </div>
                </div>
            </div>

            <!-- Onglet 2 : Calculateur de compatibilit√©, cach√© par d√©faut. -->
            <div id="compatibility-content" class="tab-content">
                <h2>Analyse de Compatibilit√©</h2>
                <p>Comparez votre th√®me avec celui d'une autre personne pour d√©couvrir vos dynamiques relationnelles.</p>
                <form id="compatibility-form">
                    <h4>Personne 1 (Vous)</h4>
                    <div class="input-group"><label for="p1-full-name">Noms & Pr√©noms</label><input type="text" id="p1-full-name" required></div>
                    <div class="input-group"><label for="p1-birth-date">Date de naissance</label><input type="text" id="p1-birth-date" required placeholder="JJ/MM/AAAA" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}"></div>
                    <hr>
                    <h4>Personne 2</h4>
                    <div class="input-group"><label for="p2-full-name">Noms & Pr√©noms</label><input type="text" id="p2-full-name" required></div>
                    <div class="input-group"><label for="p2-birth-date">Date de naissance</label><input type="text" id="p2-birth-date" required placeholder="JJ/MM/AAAA" inputmode="numeric" pattern="\d{2}/\d{2}/\d{4}"></div>
                    <button type="submit">Analyser la Compatibilit√©</button>
                </form>
                <!-- Conteneur pour les r√©sultats de compatibilit√©, initialement cach√©. -->
                <div id="compatibility-results" class="hidden"></div>
            </div>
        </main>

        <!-- Pied de page avec des informations et des liens. -->
        <footer style="text-align:center; font-size: 0.9em; opacity: 0.7; padding: 20px 0;">
            <p>Application cr√©√©e pour la d√©couverte de soi. Ne remplace pas un conseil professionnel.</p>
            <p><a id="methodology-link">Notre M√©thodologie de Calcul</a></p>
        </footer>
    </div>
    
    <!-- Fen√™tres modales (pop-ups) pour le glossaire et la m√©thodologie, cach√©es par d√©faut. -->
    <div id="glossary-modal" class="modal"><div class="modal-content"><span id="modal-close-btn" class="close-button">√ó</span><div id="modal-body"></div></div></div>
    <div id="methodology-modal" class="modal"><div class="modal-content"><span id="methodology-close-btn" class="close-button">√ó</span><div id="methodology-modal-body"></div></div></div>
    
    <!-- ========================================================================================= -->
    <!--                                    SCRIPT JAVASCRIPT                                      -->
    <!-- Toute la logique de l'application est contenue ici.                                       -->
    <!-- ========================================================================================= -->
    <script>
        // L'√©couteur d'√©v√©nement 'DOMContentLoaded' s'assure que le script ne s'ex√©cute qu'apr√®s le chargement complet du HTML.
        document.addEventListener('DOMContentLoaded', () => {

            // ========================== OBJET `data` ==========================
            // Cet objet agit comme une mini-base de donn√©es. Il centralise toutes les informations statiques
            // (valeurs des lettres, interpr√©tations, etc.) pour une maintenance et une lisibilit√© faciles.
            const data = {
                // Correspondance des lettres √† leur valeur num√©rique (syst√®me pythagoricien).
                letterValues: { 'A':1,'J':1,'S':1, 'B':2,'K':2,'T':2, 'C':3,'L':3,'U':3, 'D':4,'M':4,'V':4, 'E':5,'N':5,'W':5, 'F':6,'O':6,'X':6, 'G':7,'P':7,'Y':7, 'H':8,'Q':8,'Z':8, 'I':9,'R':9 },
                vowels: ['A', 'E', 'I', 'O', 'U', 'Y'], // La lettre 'Y' est trait√©e comme une voyelle pour le Nombre de l'√Çme.
                masterNumbers: [11, 22, 33], // Nombres Ma√Ætres qui ne sont pas r√©duits √† un seul chiffre.
                // Mappage des dettes karmiques √† leur signification.
                karmicDebtsMap: { 13: "la paresse et le travail", 14: "les abus des sens et l'instabilit√©", 16: "l'orgueil et la destruction de l'ego", 19: "l'√©go√Øsme et l'abus de pouvoir" },
                // Mots-cl√©s pour chaque √©nergie, utilis√©s dans le glossaire et l'analyse.
                energyKeywords: { 1: "Leader", 2: "Diplomate", 3: "Cr√©atif", 4: "B√¢tisseur", 5: "Aventurier", 6: "Responsable", 7: "Sage", 8: "Puissant", 9: "Humaniste", 11: "Inspir√©", 22: "Grand B√¢tisseur", 33: "Guide" },
                // Texte explicatif pour la modale de m√©thodologie.
                methodologyText: {
                    title: "Notre Approche & M√©thodologie de Calcul",
                    content: `<p>Cette application s'inspire de la <strong>num√©rologie strat√©gique</strong>, une approche moderne qui vise √† fournir des cl√©s de compr√©hension de soi actionnables. Voici les principes de calcul utilis√©s :</p>
                    <ul>
                        <li><strong>R√©duction des nombres :</strong> Tous les nombres sont r√©duits √† un seul chiffre (de 1 √† 9), sauf les <strong>Ma√Ætres Nombres 11, 22 et 33</strong>, qui conservent leur propre vibration. L'application affiche ces nombres avec leur base (ex: 22/4) pour une analyse compl√®te.</li>
                        <li><strong>Nombre de l'√Çme (√âlan Spirituel) :</strong> Il est calcul√© en additionnant la valeur de toutes les voyelles de vos noms et pr√©noms de naissance. Conform√©ment √† une convention r√©pandue, la lettre <strong>'Y' est syst√©matiquement consid√©r√©e comme une voyelle</strong> dans nos calculs. Des √©coles diff√©rentes peuvent la traiter comme une consonne dans certains cas, ce qui peut expliquer des variations de r√©sultats.</li>
                        <li><strong>Nombre de Personnalit√© (Moi Intime) :</strong> Il est obtenu par la somme des consonnes de vos noms et pr√©noms.</li>
                        <li><strong>Nombre d'Expression (Potentiel) :</strong> Il est la somme de toutes les lettres (voyelles + consonnes).</li>
                        <li><strong>Dettes Karmiques :</strong> Nous identifions les dettes karmiques (13, 14, 16, 19) lorsqu'elles apparaissent comme r√©sultat interm√©diaire avant la r√©duction finale dans les nombres principaux. Elles repr√©sentent des d√©fis sp√©cifiques √† int√©grer.</li>
                    </ul>
                    <p>La num√©rologie est un outil de r√©flexion. Diff√©rentes approches (√©volutive, karmique, etc.) peuvent utiliser des variantes de calcul. Cet outil vous offre une base solide issue d'une m√©thode reconnue pour commencer votre exploration.</p>`
                },
                
                // ==================================================================
                // NOUVELLES INTERPR√âTATIONS D√âTAILL√âES
                // ==================================================================
                interpretations: {
                    cheminDeVie: {
                        1: `<strong>Le Pionnier Ind√©pendant :</strong> Votre mission de vie est de d√©velopper votre individualit√©, votre courage et votre capacit√© √† initier. C'est un chemin qui vous demande de croire en vous, de prendre les devants et d'innover sans attendre l'approbation des autres.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Leadership naturel et ambition.</li><li>Originalit√© et cr√©ativit√© pour trouver de nouvelles solutions.</li><li>Force de caract√®re et d√©termination.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>L'impatience et la tendance √† l'autoritarisme.</li><li>La peur de la solitude ou, √† l'inverse, un isolement excessif.</li><li>Apprendre √† collaborer et √† √©couter les id√©es des autres.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Incarnez le leader inspirant, pas le tyran. Votre v√©ritable force se r√©v√®le lorsque vous utilisez votre √©nergie pour ouvrir la voie, non seulement pour vous-m√™me mais aussi pour les autres.</p>
                            </div>`,
                        2: `<strong>Le Diplomate Coop√©ratif :</strong> Votre mission est d'apprendre l'art de la collaboration, de l'harmonie et de la diplomatie. C'est un chemin qui vous invite √† d√©velopper votre patience, votre √©coute et votre capacit√© √† unir les gens et les id√©es, en trouvant l'√©quilibre et la paix.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Grande sensibilit√© et intuition pour comprendre les autres.</li><li>Capacit√© √† √™tre un m√©diateur et un partenaire loyal.</li><li>Patience et sens du d√©tail.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>L'ind√©cision et la d√©pendance √† l'opinion d'autrui.</li><li>Une trop grande sensibilit√© qui peut mener √† √™tre facilement bless√©.</li><li>La difficult√© √† dire non et √† s'affirmer.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Trouvez votre force dans la douceur. Votre pouvoir ne r√©side pas dans la confrontation, mais dans votre capacit√© √† cr√©er des ponts. Apprenez √† vous affirmer avec calme et √† faire confiance √† votre propre jugement.</p>
                            </div>`,
                        3: `<strong>Le Communicant Cr√©atif :</strong> Votre mission est d'exprimer votre cr√©ativit√©, votre joie de vivre et d'inspirer les autres par la communication. C'est un chemin d'expression de soi, que ce soit par l'art, l'√©criture, la parole ou simplement par votre optimisme contagieux.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Imagination fertile et grand talent artistique.</li><li>Excellent communicant, sociable et charismatique.</li><li>Optimisme et enthousiasme naturels.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>La dispersion et la difficult√© √† terminer ce que vous commencez.</li><li>La superficialit√© ou la peur d'aborder les √©motions profondes.</li><li>La sensibilit√© √† la critique.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Canalisez votre √©nergie cr√©atrice. Choisissez un ou deux domaines qui vous passionnent et engagez-vous √† les approfondir. Votre joie est votre guide, mais la discipline est le v√©hicule qui la transformera en r√©alisations durables.</p>
                            </div>`,
                        4: `<strong>Le B√¢tisseur Structur√© :</strong> Votre mission est de construire des fondations solides et durables, d'apporter de l'ordre, de la stabilit√© et de la s√©curit√©. C'est un chemin qui demande du travail, de la discipline, de la patience et un grand sens de l'organisation.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Fiabilit√©, pers√©v√©rance et grand sens du travail.</li><li>Capacit√© √† planifier, organiser et g√©rer les d√©tails.</li><li>Honn√™tet√© et int√©grit√©.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>La rigidit√© et la r√©sistance au changement.</li><li>Une tendance √† √™tre trop prudent ou √† voir les limites avant les opportunit√©s.</li><li>Le surmenage et la difficult√© √† d√©l√©guer.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Apprenez la flexibilit√©. Votre capacit√© √† construire est immense, mais elle devient une force inarr√™table lorsque vous acceptez que les plans peuvent changer. La vraie s√©curit√© vient de votre capacit√© √† vous adapter, pas seulement de votre capacit√© √† contr√¥ler.</p>
                            </div>`,
                        5: `<strong>L'Aventurier Libre :</strong> Votre mission est d'exp√©rimenter la libert√© √† travers le changement, le mouvement et la diversit√©. C'est un chemin d'adaptation, d'exploration et d'exp√©riences multiples qui vous demande d'embrasser l'inconnu et de vivre pleinement le moment pr√©sent.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Grande capacit√© d'adaptation et polyvalence.</li><li>Curiosit√©, esprit aventureux et amour de la nouveaut√©.</li><li>Charisme et talent pour la communication.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>L'instabilit√© et la peur de l'engagement.</li><li>La tendance √† la dispersion et √† l'exc√®s sous toutes ses formes.</li><li>L'impatience et un sentiment d'insatisfaction chronique.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> La libert√© disciplin√©e. Votre soif d'exp√©rience est un don, mais elle trouve son plein potentiel lorsque vous apprenez √† choisir vos aventures et √† vous y consacrer. La vraie libert√© n'est pas l'absence de contraintes, mais le choix conscient de celles-ci.</p>
                            </div>`,
                        6: `<strong>Le Responsable Harmonieux :</strong> Votre mission est de cultiver l'harmonie, l'amour et le sens des responsabilit√©s, notamment au sein de la famille, du foyer et de la communaut√©. C'est un chemin de service, de conseil et de gu√©rison, o√π vous apprenez √† donner et √† recevoir avec √©quilibre.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>G√©n√©rosit√©, bienveillance et sens de la protection.</li><li>Capacit√© √† cr√©er de la beaut√© et de l'harmonie.</li><li>Fiabilit√© et grand sens du devoir.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>La tendance au sacrifice et √† s'oublier pour les autres.</li><li>Le perfectionnisme et le besoin de tout contr√¥ler.</li><li>L'ing√©rence dans la vie d'autrui, en pensant savoir ce qui est bon pour eux.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> L'amour √©quilibr√©. Apprenez √† prendre soin de vous avec la m√™me d√©votion que vous prenez soin des autres. Votre responsabilit√© premi√®re est envers votre propre bien-√™tre, car on ne peut verser d'une carafe vide.</p>
                            </div>`,
                        7: `<strong>Le Sage Introspectif :</strong> Votre mission est la qu√™te de la connaissance, de la v√©rit√© et de la sagesse. C'est un chemin d'introspection, d'analyse et de connexion spirituelle, qui vous demande de regarder au-del√† des apparences pour comprendre les myst√®res de la vie.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Esprit d'analyse aiguis√© et grande capacit√© de recherche.</li><li>Intuition et perception profonde des choses.</li><li>Calme, observation et besoin de solitude pour se ressourcer.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>L'isolement et la difficult√© √† partager ses √©motions.</li><li>Le cynisme ou le scepticisme excessif.</li><li>Une tendance √† trop intellectualiser et √† se couper du corps et du c≈ìur.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> La sagesse partag√©e. Votre qu√™te int√©rieure prend tout son sens lorsque vous trouvez un moyen de transmettre ce que vous avez appris. La foi, non pas n√©cessairement religieuse mais en la vie elle-m√™me, est le pont entre votre monde int√©rieur et le monde ext√©rieur.</p>
                            </div>`,
                        8: `<strong>Le Ma√Ætre Ambitieux :</strong> Votre mission est de ma√Ætriser le monde mat√©riel, le pouvoir et l'abondance. C'est un chemin qui vous demande de d√©velopper votre ambition, votre autorit√© et votre capacit√© √† g√©rer de grands projets, tout en apprenant √† utiliser ce pouvoir avec √©thique et g√©n√©rosit√©.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Ambition, pers√©v√©rance et vision strat√©gique.</li><li>Grande capacit√© de travail et d'organisation.</li><li>Charisme, autorit√© naturelle et sens de la justice.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>L'autoritarisme et une focalisation excessive sur l'argent et le pouvoir.</li><li>L'impatience et une attitude "tout ou rien".</li><li>La difficult√© √† exprimer sa vuln√©rabilit√© et ses √©motions.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Le pouvoir au service des autres. Votre v√©ritable ma√Ætrise s'accomplit lorsque votre succ√®s personnel contribue √©galement au bien-√™tre collectif. L'√©quilibre entre le mat√©riel et le spirituel est la cl√© de votre √©panouissement.</p>
                            </div>`,
                        9: `<strong>L'Humaniste Altruiste :</strong> Votre mission est de d√©velopper la compassion, la tol√©rance et une vision universelle. C'est un chemin d'ouverture au monde, de service √† l'humanit√© et d'accomplissement de grandes causes, qui vous demande d'apprendre √† donner sans rien attendre en retour et √† l√¢cher prise.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Grande g√©n√©rosit√©, altruisme et sensibilit√©.</li><li>Id√©alisme et capacit√© √† inspirer les autres.</li><li>Ouverture d'esprit et vision large des choses.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>Une √©motivit√© intense et la difficult√© √† g√©rer ses propres besoins.</li><li>La tendance √† vivre dans le pass√© et √† ne pas pardonner (√† soi ou aux autres).</li><li>Le d√©senchantement face aux dures r√©alit√©s du monde.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> L'accomplissement et le l√¢cher-prise. Votre chemin culmine dans la finalisation des cycles. Apprenez √† terminer ce que vous avez commenc√©, √† pardonner et √† laisser partir ce qui ne vous sert plus. Votre sagesse r√©side dans votre capacit√© √† aimer le monde tel qu'il est, tout en ≈ìuvrant pour le rendre meilleur.</p>
                            </div>`,
                        11: `<strong>L'Inspir√© Visionnaire (11/2) :</strong> Ma√Ætre Nombre. Votre mission est double : vous incarnez l'intuition fulgurante et la r√©v√©lation du 11, tout en devant apprendre la diplomatie et la coop√©ration du 2. C'est un chemin de haute tension spirituelle, qui vous demande de faire le pont entre le monde visible et invisible.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Intuition exceptionnelle et capacit√© √† canaliser des id√©es novatrices.</li><li>Charisme magn√©tique et potentiel pour inspirer les foules.</li><li>Grande sensibilit√© et empathie (h√©rit√©es du 2).</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>Une forte tension nerveuse et de l'anxi√©t√© due √† l'hyper-sensibilit√©.</li><li>Le d√©calage entre vos id√©aux √©lev√©s et la r√©alit√©, pouvant mener √† la frustration.</li><li>La difficult√© √† vivre la mission du 11, menant √† un repli sur les aspects plus passifs du 2.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Ancrez votre vision. Votre d√©fi est de ne pas rester dans le monde des id√©es. Utilisez la patience et la diplomatie du 2 pour concr√©tiser vos inspirations et les rendre accessibles aux autres. Vous √™tes un phare, apprenez √† briller sans vous br√ªler.</p>
                            </div>`,
                        22: `<strong>Le Grand B√¢tisseur (22/4) :</strong> Ma√Ætre Nombre. Votre mission est monumentale : transformer les r√™ves les plus ambitieux en r√©alisations concr√®tes au service de l'humanit√©. Vous combinez la vision illimit√©e du 22 avec le pragmatisme et la m√©thode du 4.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Vision √† grande √©chelle et capacit√© √† g√©rer des projets complexes.</li><li>Endurance, pragmatisme et discipline exceptionnels (h√©rit√©s du 4).</li><li>Potentiel pour laisser un h√©ritage durable et significatif.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>Une pression immense et la peur de ne pas √™tre √† la hauteur de son potentiel.</li><li>La tendance √† l'obstination et √† la rigidit√© du 4 si la vision du 22 est perdue.</li><li>La tentation d'utiliser ce pouvoir √† des fins purement personnelles.</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> Construisez pas √† pas. Votre vision est vaste, mais elle ne se r√©alisera qu'√† travers le travail m√©thodique et pers√©v√©rant du 4. Le succ√®s vient en d√©composant vos r√™ves immenses en √©tapes r√©alisables. La grandeur se trouve dans chaque brique que vous posez avec conscience.</p>
                            </div>`,
                        33: `<strong>Le Guide Spirituel (33/6) :</strong> Ma√Ætre Nombre. Votre mission est celle du service aimant et de la gu√©rison √† une √©chelle universelle. Vous portez l'amour inconditionnel et le sens des responsabilit√©s du 6 √† son octave sup√©rieure, devenant un guide ou un enseignant pour les autres.
                            <div class="interpretation-details">
                                <p><strong>Vos forces sur ce chemin :</strong></p>
                                <ul><li>Compassion et altruisme immenses.</li><li>Capacit√© √† enseigner, gu√©rir et conseiller avec une grande sagesse.</li><li>Talents artistiques et cr√©atifs au service de l'√©l√©vation des consciences.</li></ul>
                                <p><strong>Les d√©fis √† ma√Ætriser :</strong></p>
                                <ul><li>Le fardeau des responsabilit√©s, pouvant mener √† l'√©puisement ou au sacrifice.</li><li>La difficult√© √† mettre des limites saines et √† ne pas absorber les souffrances du monde.</li><li>Le perfectionnisme et l'autocritique (h√©rit√©s du 6).</li></ul>
                                <p><strong>Votre cl√© d'√©volution :</strong> La joie dans le service. Votre mission n'est pas de porter le monde sur vos √©paules, mais d'√™tre un exemple vivant de l'amour et de la joie. Apprenez √† servir sans souffrir, en trouvant l'√©quilibre parfait entre donner aux autres et prendre soin de votre propre lumi√®re int√©rieure.</p>
                            </div>`
                    },
                    // Les autres sections (expression, ame, etc.) peuvent √™tre enrichies de la m√™me mani√®re.
                    // Pour garder la r√©ponse concise, je vais me concentrer sur le Chemin de Vie qui est le plus important,
                    // mais le principe est le m√™me pour toutes les interpr√©tations. Voici des exemples plus courts pour les autres.
                    expression: {
                        1: "<strong>Le Potentiel du Leader :</strong> Vous √™tes ici pour diriger, innover et agir. Vos outils sont le courage, l'ind√©pendance et une volont√© de fer. Utilisez-les pour initier des projets et tracer votre propre chemin. Attention √† ne pas devenir autoritaire.",
                        5: "<strong>Le Potentiel de l'Agent du Changement :</strong> Vos outils sont la polyvalence, la communication et une incroyable capacit√© d'adaptation. Vous √™tes fait pour le mouvement, les voyages et la nouveaut√©. Votre d√©fi est de ne pas vous disperser et d'utiliser cette libert√© de mani√®re constructive.",
                        9: "<strong>Le Potentiel de l'Humaniste :</strong> Vos dons sont la compassion, l'altruisme et une vision globale. Vous avez le potentiel d'inspirer et d'aider les autres √† grande √©chelle. Apprenez √† donner sans vous √©puiser et √† finaliser vos projets pour que votre impact soit r√©el."
                    },
                    ame: {
                        1: "<strong>D√©sir Profond d'Ind√©pendance :</strong> Au plus profond de vous, votre √¢me aspire √† √™tre num√©ro un, √† √™tre libre de toute contrainte et √† suivre sa propre voie. Vous avez un besoin visc√©ral d'autonomie et de reconnaissance pour vos propres m√©rites. Ce d√©sir est le moteur de votre ambition.",
                        8: "<strong>D√©sir Profond de Ma√Ætrise et d'Impact :</strong> Votre √¢me est anim√©e par une qu√™te de pouvoir et de r√©alisation mat√©rielle. Vous ne cherchez pas l'argent pour l'argent, mais pour la s√©curit√©, la libert√© et l'impact qu'il permet. Vous aspirez √† construire quelque chose de grand et de durable.",
                        11: "<strong>D√©sir Profond de R√©v√©lation :</strong> Votre √¢me a soif de connexion spirituelle et d'intuition. Vous √™tes motiv√© par un besoin de comprendre les v√©rit√©s cach√©es et de vivre une vie inspir√©e, en accord avec des id√©aux √©lev√©s. L'ordinaire vous ennuie ; vous cherchez l'extraordinaire."
                    },
                    personnalite: {
                        6: "<strong>Image du Conseiller Fiable :</strong> Les autres vous per√ßoivent comme une personne chaleureuse, responsable et digne de confiance. On vient naturellement vers vous pour chercher conseil ou r√©confort. Vous d√©gagez une aura de stabilit√© et de bienveillance, celle d'un pilier sur lequel on peut s'appuyer.",
                        33: "<strong>Image du Guide Charismatique (33/6) :</strong> Vous projetez une image d'une sagesse et d'une compassion exceptionnelles. Les autres ressentent votre aura de guide et sont attir√©s par votre capacit√© √† apaiser et √† inspirer. Attention √† ne pas √™tre √©cras√© par les attentes que cette image puissante peut g√©n√©rer."
                    },
                    nombreActif: {
                        8: "<strong>Action Puissante et Strat√©gique :</strong> Quand vous d√©cidez d'agir, vous le faites avec force et ambition. Votre mode d'action est direct, efficace et orient√© vers des r√©sultats concrets. Vous n'avez pas peur de prendre les commandes pour atteindre vos objectifs.",
                    }
                },
                
                dailyVibration: { 1:"<strong>Initiative & Action :</strong> Journ√©e id√©ale pour d√©marrer de nouveaux projets et affirmer votre ind√©pendance. Prenez les devants !", 2:"<strong>Patience & Diplomatie :</strong> Ralentissez. C'est un jour pour √©couter, collaborer et faire preuve de tact. Favorisez les partenariats.", 3:"<strong>Cr√©ativit√© & Communication :</strong> Exprimez-vous ! Une excellente journ√©e pour socialiser, rire, cr√©er et partager vos id√©es avec optimisme.", 4:"<strong>Travail & Organisation :</strong> Concentrez-vous sur les d√©tails et le travail m√©thodique. Journ√©e parfaite pour ranger, planifier et construire des bases solides.", 5:"<strong>Changement & Aventure :</strong> Attendez-vous √† l'inattendu. Soyez flexible, ouvert aux nouvelles exp√©riences et pr√™t √† bouger. √âvitez la routine.", 6:"<strong>Harmonie & Responsabilit√©s :</strong> Le foyer et les relations sont au centre. Un jour pour prendre soin de vos proches, embellir votre environnement et assumer vos responsabilit√©s.", 7:"<strong>Introspection & R√©flexion :</strong> Prenez du temps pour vous. C'est un jour pour analyser, m√©diter, et chercher des r√©ponses √† l'int√©rieur. Ne forcez rien.", 8:"<strong>Ambition & Pouvoir :</strong> Concentrez-vous sur vos finances et votre carri√®re. Journ√©e propice aux d√©cisions importantes, aux n√©gociations et √† l'affirmation de votre autorit√©.", 9:"<strong>Bilan & Altruisme :</strong> C'est un jour pour finaliser, pardonner et l√¢cher-prise. Aidez les autres et terminez ce qui est en cours avant de commencer du neuf.", 11: "<strong>Intuition & R√©v√©lation (11/2) :</strong> Une journ√©e de grande sensibilit√©. Fiez-vous √† votre intuition (11), elle est particuli√®rement forte. Les tensions sont possibles, cherchez l'harmonie du 2.", 22: "<strong>Construction & Vision (22/4) :</strong> Potentiel de r√©aliser quelque chose de grand. C'est un jour 4 √† une √©chelle sup√©rieure. R√™vez grand (22), mais ancrez vos actions dans le concret (4).", 33: "<strong>Compassion & Gu√©rison (33/6) :</strong> Journ√©e de service et d'amour universel (33). Une √©nergie de jour 6 amplifi√©e. Soyez une source d'inspiration et de r√©confort pour les autres." },
                compatibility: {
                    relations: { '1': { harmony: [1, 3, 5], challenge: [6, 8], neutral: [2, 4, 7, 9] }, '2': { harmony: [2, 4, 6, 8], challenge: [5, 7], neutral: [1, 3, 9] }, '3': { harmony: [1, 3, 5, 6, 9], challenge: [], neutral: [2, 4, 7, 8] }, '4': { harmony: [2, 4, 6, 8], challenge: [5, 7], neutral: [1, 3, 9] }, '5': { harmony: [1, 3, 5], challenge: [2, 4], neutral: [6, 7, 8, 9] }, '6': { harmony: [2, 3, 4, 6, 9], challenge: [1, 8], neutral: [5, 7] }, '7': { harmony: [7, 9], challenge: [2, 4, 8], neutral: [1, 3, 5, 6] }, '8': { harmony: [2, 4, 6, 8], challenge: [1, 7], neutral: [3, 5, 9] }, '9': { harmony: [3, 6, 9], challenge: [], neutral: [1, 2, 4, 5, 7, 8] }, },
                    summary: { harmony: "Dynamique tr√®s favorable, marqu√©e par une compr√©hension et un soutien mutuels. Les √©nergies s'alignent naturellement.", challenge: "Relation de croissance. Les diff√©rences peuvent cr√©er des frictions, mais offrent de puissantes le√ßons si elles sont comprises.", neutral: "Compatibilit√© √©quilibr√©e. La relation d√©pendra de la volont√© des deux partenaires de s'adapter et de communiquer." }
                }
            };

            // ========================== OBJET `calculator` ==========================
            // Cet objet contient toute la logique de calcul. Il est ind√©pendant de l'interface utilisateur,
            // ce qui le rend pur et facile √† tester. C'est le "moteur" de l'application.
            const calculator = {
                /**
                 * R√©duit un nombre par addition th√©osophique jusqu'√† obtenir un seul chiffre (1-9) ou un Ma√Ætre Nombre (11, 22, 33).
                 * @param {number|string} n - Le nombre √† r√©duire.
                 * @param {boolean} [keepMasters=true] - Si vrai, la r√©duction s'arr√™te si le nombre est 11, 22 ou 33.
                 * @returns {number} Le nombre r√©duit.
                 */
                reduceNumber(n, keepMasters = true) {
                    let num = parseInt(n, 10);
                    if (isNaN(num)) return 0;
                    // La boucle continue tant que le nombre est sup√©rieur √† 9 ET (soit on ne garde pas les ma√Ætres, soit le nombre n'en est pas un).
                    while (num > 9 && (!keepMasters || !data.masterNumbers.includes(num))) {
                        num = String(num).split('').reduce((acc, digit) => acc + parseInt(digit, 10), 0);
                    }
                    return num;
                },

                /**
                 * Calcule un nombre num√©rologique complexe, identifiant sa valeur finale, sa dette karmique √©ventuelle et sa valeur de base s'il s'agit d'un ma√Ætre nombre.
                 * @param {number} sum - La somme initiale avant toute r√©duction.
                 * @returns {object} Un objet contenant la valeur finale, la dette karmique, la somme initiale et la valeur de base.
                 */
                calculateComplexNumber(sum) {
                    const karmicDebt = Object.keys(data.karmicDebtsMap).map(Number).includes(sum) ? sum : null;
                    const finalValue = this.reduceNumber(sum);
                    let baseValue = null;
                    if(data.masterNumbers.includes(finalValue)) {
                        baseValue = this.reduceNumber(finalValue, false); // On r√©duit le ma√Ætre nombre pour obtenir sa base (ex: 22 -> 4).
                    }
                    return { value: finalValue, karmicDebt, initialSum: sum, baseValue };
                },

                /**
                 * Calcule la valeur num√©rologique d'un nom ou pr√©nom en fonction du type de lettres √† additionner (toutes, voyelles, consonnes).
                 * @param {string} name - La cha√Æne de caract√®res √† analyser.
                 * @param {'all'|'vowels'|'consonants'} type - Le type de lettres √† prendre en compte.
                 * @returns {object} Un objet complexe avec la valeur, la dette, les d√©tails du calcul, etc.
                 */
                calculateNameNumber(name, type) {
                    if (!name) return { value: 0, initialSum: 0, karmicDebt: null, baseValue: null, details: "Aucun nom fourni" };
                    // Normalise le nom : enl√®ve les accents, met en majuscules, et supprime les caract√®res non alphab√©tiques.
                    const normalizedName = name.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase().replace(/[^A-Z\s]/g, '');
                    let sum = 0;
                    let details = []; // Pour stocker les √©tapes du calcul √† des fins d'affichage.
                    for (const char of normalizedName) {
                        if (char === ' ') continue;
                        const isVowel = data.vowels.includes(char);
                        if ((type === 'all') || (type === 'vowels' && isVowel) || (type === 'consonants' && !isVowel)) {
                            const value = data.letterValues[char] || 0;
                            sum += value;
                            details.push(`${char}(${value})`);
                        }
                    }
                    if (details.length === 0) return { value: 0, initialSum: 0, karmicDebt: null, baseValue: null, details: "Aucune lettre valide trouv√©e." };
                    const result = this.calculateComplexNumber(sum);
                    result.details = `${details.join(' + ')} = ${result.initialSum}${result.karmicDebt ? ` (Dette ${result.karmicDebt})` : ''} ‚ûî ${result.value}`;
                    return result;
                },

                /**
                 * Calcule le Chemin de Vie √† partir d'une date de naissance (format YYYY-MM-DD).
                 * M√©thode : Jour r√©duit + Mois r√©duit + Ann√©e r√©duite.
                 * @param {string} date - La date de naissance au format 'YYYY-MM-DD'.
                 * @returns {object} Le r√©sultat du Chemin de Vie.
                 */
                calculateLifePath(date) {
                    const [year, month, day] = date.split('-');
                    // Chaque partie de la date est r√©duite s√©par√©ment avant d'√™tre additionn√©e. C'est une m√©thode de calcul courante.
                    const sum = this.reduceNumber(day, false) + this.reduceNumber(month, false) + this.reduceNumber(year, false);
                    const result = this.calculateComplexNumber(sum);
                    result.details = `Jour(${this.reduceNumber(day, false)}) + Mois(${this.reduceNumber(month, false)}) + Ann√©e(${this.reduceNumber(year, false)}) = ${result.initialSum} ‚ûî ${result.value}`;
                    return result;
                },

                /**
                 * Calcule la Vibration du Jour en combinant la date de naissance de l'utilisateur avec la date actuelle.
                 * @param {string} birthDate - Date de naissance de l'utilisateur ('YYYY-MM-DD').
                 * @returns {object} Le r√©sultat de la vibration du jour.
                 */
                calculateDailyVibration(birthDate) {
                    if (!birthDate) return { value: 0, baseValue: null };
                    const today = new Date();
                    const [year, month, day] = birthDate.split('-').map(Number);
                    const sum = this.reduceNumber(day, false) + this.reduceNumber(month, false) + this.reduceNumber(today.getDate(), false) + this.reduceNumber(today.getMonth() + 1, false) + this.reduceNumber(today.getFullYear(), false);
                    return this.calculateComplexNumber(sum);
                },

                /**
                 * Calcule la pr√©sence de chaque √©nergie (1-9) dans le nom complet de l'utilisateur.
                 * @param {string} fullName - Le nom complet.
                 * @returns {object} Un objet avec le compte pour chaque nombre (ex: {1: 3, 2: 1, ...}).
                 */
                calculateEnergyPresence(fullName) {
                    const presence = { 1:0, 2:0, 3:0, 4:0, 5:0, 6:0, 7:0, 8:0, 9:0 };
                    const normalizedName = fullName.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase().replace(/[^A-Z]/g, '');
                    for (const char of normalizedName) {
                        if (data.letterValues[char]) {
                            presence[data.letterValues[char]]++;
                        }
                    }
                    return presence;
                },

                /**
                 * Calcule les 4 grands cycles de vie (pinacles et d√©fis).
                 * @param {string} birthDate - La date de naissance 'YYYY-MM-DD'.
                 * @param {number} lifePathValue - La valeur r√©duite du chemin de vie.
                 * @returns {Array<object>} Un tableau d'objets, chacun repr√©sentant un cycle de vie.
                 */
                calculateLifeCycles(birthDate, lifePathValue) {
                    const [year, month, day] = birthDate.split('-').map(Number);
                    const dayR = this.reduceNumber(day, false), monthR = this.reduceNumber(month, false), yearR = this.reduceNumber(year, false);
                    // L'√¢ge de transition du premier au deuxi√®me cycle est calcul√© √† partir du chemin de vie.
                    const age1 = 36 - this.reduceNumber(lifePathValue, false);
                    return [
                        { age: `0 √† ${age1} ans`, pinnacle: this.reduceNumber(monthR + dayR, false), challenge: this.reduceNumber(Math.abs(monthR - dayR), false) },
                        { age: `${age1 + 1} √† ${age1 + 9} ans`, pinnacle: this.reduceNumber(dayR + yearR, false), challenge: this.reduceNumber(Math.abs(dayR - yearR), false) },
                        { age: `${age1 + 10} √† ${age1 + 18} ans`, pinnacle: this.reduceNumber(this.reduceNumber(monthR + dayR, false) + this.reduceNumber(dayR + yearR, false), false), challenge: this.reduceNumber(Math.abs(this.reduceNumber(Math.abs(monthR - dayR), false) - this.reduceNumber(Math.abs(dayR - yearR), false)), false) },
                        { age: `Apr√®s ${age1 + 18} ans`, pinnacle: this.reduceNumber(monthR + yearR, false), challenge: this.reduceNumber(Math.abs(monthR - yearR), false) }
                    ];
                },
                
                /**
                 * Fonction principale du calculateur. Orchestre tous les calculs pour g√©n√©rer un th√®me complet.
                 * @param {string} fullName - Le nom complet de l'utilisateur.
                 * @param {string} birthDate - La date de naissance 'YYYY-MM-DD'.
                 * @returns {object} Un objet contenant tous les r√©sultats du th√®me num√©rologique.
                 */
                getTheme(fullName, birthDate) {
                    const cleanedFullName = fullName.trim().replace(/\s+/g, ' ');
                    const firstName = cleanedFullName.split(' ')[0];
                    const lifePath = this.calculateLifePath(birthDate);
                    return {
                        fullName: cleanedFullName, firstName, birthDate, lifePath,
                        expression: this.calculateNameNumber(cleanedFullName, 'all'),
                        soul: this.calculateNameNumber(cleanedFullName, 'vowels'),
                        personality: this.calculateNameNumber(cleanedFullName, 'consonants'),
                        active: this.calculateNameNumber(firstName, 'all'),
                        dailyVibration: this.calculateDailyVibration(birthDate),
                        energyPresence: this.calculateEnergyPresence(cleanedFullName),
                        lifeCycles: this.calculateLifeCycles(birthDate, lifePath.value),
                    };
                }
            };

            // ========================== OBJET `ui` ==========================
            // Cet objet g√®re toutes les interactions avec le DOM (Document Object Model).
            // Il est responsable de l'√©coute des √©v√©nements (clics, soumissions de formulaires)
            // et de l'affichage des r√©sultats calcul√©s. C'est le "contr√¥leur" et la "vue" de l'application.
            const ui = {
                // Centralise tous les √©l√©ments du DOM pour un acc√®s facile et performant.
                elements: {
                    form: document.getElementById('numerology-form'), nameInput: document.getElementById('full-name'), dateInput: document.getElementById('birth-date'),
                    resultsWrapper: document.getElementById('results-wrapper'), dailyVibrationContainer: document.getElementById('daily-vibration-container'),
                    summaryContainer: document.getElementById('summary-container'), energyContainer: document.getElementById('energy-presence-container'),
                    cyclesContainer: document.getElementById('life-cycles-container'), resultsContainer: document.getElementById('results-container'),
                    profileCardContainer: document.getElementById('profile-card-container'), profileCardCanvas: document.getElementById('profile-card-canvas'),
                    printBtn: document.getElementById('print-btn'), aiExportBtn: document.getElementById('ai-export-btn'), profileCardBtn: document.getElementById('profile-card-btn'),
                    themeToggle: document.getElementById('theme-toggle'), welcomeBack: document.getElementById('welcome-back'),
                    navTheme: document.getElementById('nav-theme'), navCompatibility: document.getElementById('nav-compatibility'),
                    themeContent: document.getElementById('theme-content'), compatibilityContent: document.getElementById('compatibility-content'),
                    compatForm: document.getElementById('compatibility-form'), p1Name: document.getElementById('p1-full-name'), p1Date: document.getElementById('p1-birth-date'),
                    p2Name: document.getElementById('p2-full-name'), p2Date: document.getElementById('p2-birth-date'), compatResultsContainer: document.getElementById('compatibility-results'),
                    glossaryModal: document.getElementById('glossary-modal'), modalCloseBtn: document.getElementById('modal-close-btn'), modalBody: document.getElementById('modal-body'),
                    methodologyModal: document.getElementById('methodology-modal'), methodologyCloseBtn: document.getElementById('methodology-close-btn'), methodologyModalBody: document.getElementById('methodology-modal-body'), methodologyLink: document.getElementById('methodology-link'),
                },

                /**
                 * Initialise l'interface utilisateur en attachant tous les √©couteurs d'√©v√©nements n√©cessaires.
                 * C'est le point d'entr√©e de l'objet `ui`.
                 */
                init() {
                    // Gestion du mode sombre : applique le th√®me et enregistre le choix de l'utilisateur.
                    this.elements.themeToggle.addEventListener('change', () => { document.body.classList.toggle('dark-mode'); localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light'); });
                    if (localStorage.getItem('theme') === 'dark') { document.body.classList.add('dark-mode'); this.elements.themeToggle.checked = true; }
                    
                    // Gestion de la navigation par onglets.
                    this.elements.navTheme.addEventListener('click', () => this.toggleView('theme'));
                    this.elements.navCompatibility.addEventListener('click', () => this.toggleView('compatibility'));
                    
                    // Gestion de la soumission des formulaires.
                    this.elements.form.addEventListener('submit', e => { e.preventDefault(); this.handleThemeSubmit(); });
                    this.elements.compatForm.addEventListener('submit', e => { e.preventDefault(); this.handleCompatibilitySubmit(e); });
                    
                    // Formatage automatique des dates lors de la saisie.
                    [this.elements.dateInput, this.elements.p1Date, this.elements.p2Date].forEach(input => { input.addEventListener('input', this.formatDateInput); });
                    
                    // R√©cup√©ration des donn√©es de l'utilisateur depuis le localStorage pour pr√©-remplir le formulaire.
                    const savedUser = JSON.parse(localStorage.getItem('numerologyUser'));
                    if (savedUser && savedUser.name && savedUser.date) {
                        this.elements.nameInput.value = savedUser.name;
                        this.elements.dateInput.value = this.formatDateForDisplay(savedUser.date);
                        this.elements.p1Name.value = savedUser.name;
                        this.elements.p1Date.value = this.formatDateForDisplay(savedUser.date);
                        this.elements.welcomeBack.innerHTML = `Heureux de vous revoir, ${savedUser.name.split(' ')[0]} !`;
                        this.elements.welcomeBack.classList.remove('hidden');
                        this.displayThemeResults(savedUser.name, savedUser.date, true); // `true` pour indiquer un rechargement.
                    }

                    // Gestion de la fermeture des modales.
                    this.elements.modalCloseBtn.onclick = () => this.elements.glossaryModal.style.display = "none";
                    this.elements.methodologyCloseBtn.onclick = () => this.elements.methodologyModal.style.display = "none";
                    this.elements.methodologyLink.onclick = () => this.openMethodologyModal();
                    
                    // Permet de fermer la modale en cliquant en dehors de celle-ci.
                    window.onclick = (event) => {
                        if (event.target == this.elements.glossaryModal) this.elements.glossaryModal.style.display = "none";
                        if (event.target == this.elements.methodologyModal) this.elements.methodologyModal.style.display = "none";
                    };
                },
                
                /**
                 * Formate un objet r√©sultat pour l'affichage, g√©rant les ma√Ætres nombres (ex: 22/4).
                 * @param {object} result - L'objet r√©sultat du calculateur.
                 * @returns {string} La cha√Æne de caract√®res format√©e.
                 */
                formatNumberForDisplay(result) {
                    if (result && result.baseValue) { return `${result.value}/${result.baseValue}`; }
                    return result ? result.value : '';
                },

                /**
                 * G√©n√®re le contenu HTML pour les cercles de nombres, avec une gestion sp√©ciale pour les ma√Ætres nombres.
                 * @param {object} result - L'objet r√©sultat du calculateur.
                 * @returns {string} Le HTML pour le contenu du cercle.
                 */
                generateCircleHTML(result) {
                    if (result && result.baseValue) {
                        return `<span class="master-part">${result.value}</span><hr class="separator"><span class="base-part">${result.baseValue}</span>`;
                    }
                    return result ? result.value : '';
                },

                /**
                 * Analyse et valide une cha√Æne de date au format 'JJ/MM/AAAA' et la convertit en 'YYYY-MM-DD'.
                 * @param {string} dateString - La date √† analyser.
                 * @returns {string|null} La date au format 'YYYY-MM-DD' ou null si invalide.
                 */
                parseAndValidateDate(dateString) {
                    const regex = /^(\d{2})\/(\d{2})\/(\d{4})$/; if (!regex.test(dateString)) return null;
                    const [, day, month, year] = dateString.match(regex);
                    const date = new Date(`${year}-${month}-${day}T00:00:00`);
                    if (date.getFullYear() != year || (date.getMonth() + 1) != month || date.getDate() != day) return null; // V√©rifie la validit√© de la date (ex: 31/02/2023).
                    return `${year}-${month.padStart(2,'0')}-${day.padStart(2,'0')}`;
                },

                formatDateForDisplay(dateString) { if (!dateString) return ''; const [year, month, day] = dateString.split('-'); return `${day}/${month}/${year}`; },
                formatDateInput(e) { let input = e.target; let value = input.value.replace(/\D/g, ''); if (value.length > 2) value = value.slice(0, 2) + '/' + value.slice(2); if (value.length > 5) value = value.slice(0, 5) + '/' + value.slice(5, 9); input.value = value; },
                
                /**
                 * G√®re l'affichage des onglets (Th√®me ou Compatibilit√©).
                 * @param {'theme'|'compatibility'} view - La vue √† afficher.
                 */
                toggleView(view) {
                    const isTheme = view === 'theme';
                    this.elements.themeContent.classList.toggle('active', isTheme);
                    this.elements.compatibilityContent.classList.toggle('active', !isTheme);
                    this.elements.navTheme.classList.toggle('active', isTheme);
                    this.elements.navCompatibility.classList.toggle('active', !isTheme);
                },

                /**
                 * G√®re la soumission du formulaire de th√®me principal.
                 */
                handleThemeSubmit() {
                    const fullName = this.elements.nameInput.value; const birthDate = this.parseAndValidateDate(this.elements.dateInput.value);
                    if (!fullName || !birthDate) { alert("Veuillez remplir tous les champs, avec une date valide au format JJ/MM/AAAA."); return; }
                    localStorage.setItem('numerologyUser', JSON.stringify({ name: fullName, date: birthDate }));
                    this.displayThemeResults(fullName, birthDate, false);
                    this.elements.p1Name.value = fullName; this.elements.p1Date.value = this.formatDateForDisplay(birthDate);
                },
                
                /**
                 * G√®re la soumission du formulaire de compatibilit√©.
                 */
                handleCompatibilitySubmit(e){
                    const p1Name = this.elements.p1Name.value; const p1Date = this.parseAndValidateDate(this.elements.p1Date.value);
                    const p2Name = this.elements.p2Name.value; const p2Date = this.parseAndValidateDate(this.elements.p2Date.value);
                    if(!p1Name || !p1Date || !p2Name || !p2Date) { alert("Veuillez remplir les informations des deux personnes, avec des dates valides au format JJ/MM/AAAA."); return; }
                    const p1Theme = calculator.getTheme(p1Name, p1Date); const p2Theme = calculator.getTheme(p2Name, p2Date);
                    this.displayCompatibilityResults(p1Theme, p2Theme); e.target.querySelector('button').scrollIntoView({ behavior: 'smooth', block: 'end' });
                },

                /**
                 * Affiche tous les r√©sultats du th√®me num√©rologique.
                 * @param {string} fullName - Nom complet de l'utilisateur.
                 * @param {string} birthDate - Date de naissance ('YYYY-MM-DD').
                 * @param {boolean} isReload - Vrai si les donn√©es proviennent du cache (localStorage).
                 */
                displayThemeResults(fullName, birthDate, isReload) {
                    const theme = calculator.getTheme(fullName, birthDate);
                    const mainResults = new Map([
                        ['Chemin de Vie', { key: 'cheminDeVie', result: theme.lifePath, description: "Votre mission de vie, les grandes le√ßons √† apprendre et le potentiel √† r√©aliser." }],
                        ['Nombre d\'Expression', { key: 'expression', result: theme.expression, description: "Vos talents et potentiels inn√©s. Ce sont vos outils pour naviguer la vie." }],
                        ['Nombre de l\'√Çme', { key: 'ame', result: theme.soul, description: "Vos d√©sirs profonds, ce qui vous motive et vous anime de l'int√©rieur." }],
                        ['Nombre de Personnalit√©', { key: 'personnalite', result: theme.personality, description: "L'image que vous projetez, la premi√®re impression que les autres ont de vous." }],
                        ['Nombre Actif', { key: 'nombreActif', result: theme.active, description: "Votre √©nergie d'action, la fa√ßon dont vous initiez les choses." }]
                    ]);
                    
                    // Affiche les diff√©rentes sections des r√©sultats.
                    this.displayDailyVibration(theme.dailyVibration);
                    this.displaySummary(theme.lifePath, theme.expression);
                    this.displayEnergyChart(theme.energyPresence);
                    this.displayLifeCycles(theme.lifeCycles);

                    this.elements.resultsContainer.innerHTML = ''; // Vide les anciens r√©sultats.
                    mainResults.forEach((resultData, title) => { this.elements.resultsContainer.appendChild(this.createResultCard(title, resultData)); });
                    
                    this.elements.resultsWrapper.classList.remove('hidden'); // Affiche le conteneur des r√©sultats.
                    this.animateCards('#theme-content .card'); // Lance l'animation des cartes.
                    if (!isReload) { setTimeout(() => this.elements.resultsWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' }), 200); } // D√©file vers les r√©sultats.
                    this.setupActionButtons(theme, mainResults); // Configure les boutons d'action (IA, PDF...).
                },
                
                /**
                 * Cr√©e une carte de r√©sultat HTML √† partir des donn√©es d'un nombre.
                 * @param {string} title - Le titre de la carte (ex: "Chemin de Vie").
                 * @param {object} resultData - L'objet contenant les informations du r√©sultat.
                 * @returns {HTMLElement} L'√©l√©ment div de la carte.
                 */
                createResultCard(title, resultData) {
                    const interpretationText = data.interpretations[resultData.key]?.[resultData.result.value] || "Interpr√©tation non disponible.";
                    const card = document.createElement('div');
                    card.className = 'card result-card';
                    const circleHTML = this.generateCircleHTML(resultData.result);
                    let karmicHTML = '';
                    if(resultData.result.karmicDebt) {
                        karmicHTML = `<div class="karmic-warning">‚ö†Ô∏è <strong>D√©fi Karmique ${resultData.result.karmicDebt} :</strong> Ce nombre indique un d√©fi sp√©cifique, un 'frein' √† transformer en force, li√© √† ${data.karmicDebtsMap[resultData.result.karmicDebt]}.</div>`;
                    }
                    let methodologyNoteHTML = '';
                    if(title === 'Nombre de l\'√Çme') {
                        methodologyNoteHTML = `<p class="methodology-note">‚ÑπÔ∏è Calcul√© avec les voyelles du nom complet (A, E, I, O, U, Y). Voir "Notre M√©thodologie" en bas de page pour plus de d√©tails.</p>`;
                    }
                    card.innerHTML = `<h2><span class="number-circle" data-number="${resultData.result.value}">${circleHTML}</span>${title}</h2><p class="description">${resultData.description}</p><div>${interpretationText}</div>${karmicHTML}<details><summary>Voir le calcul</summary><div class="calculation-details" style="font-size:0.9em; opacity:0.8; padding-top:10px;">${resultData.result.details}</div></details>${methodologyNoteHTML}`;
                    // Ajoute un √©v√©nement pour ouvrir le glossaire au clic sur le cercle.
                    card.querySelector('.number-circle').addEventListener('click', (e) => this.openGlossaryModal(e.currentTarget.dataset.number));
                    return card;
                },

                /** Affiche la carte de la vibration du jour. */
                displayDailyVibration(vibration) {
                    const circleHTML = this.generateCircleHTML(vibration);
                    this.elements.dailyVibrationContainer.innerHTML = `<div class="card daily-vibration-card"><h2 class="fade-in"><span class="number-circle" data-number="${vibration.value}">${circleHTML}</span>Votre Vibration du Jour</h2><p class="description fade-in">${data.dailyVibration[vibration.value] || "Journ√©e d'√©nergie intense et de potentiel √©lev√©."}</p></div>`;
                    this.elements.dailyVibrationContainer.querySelector('.number-circle').addEventListener('click', (e) => this.openGlossaryModal(e.currentTarget.dataset.number));
                },
                
                /** Affiche la carte de synth√®se strat√©gique (Chemin de Vie vs Expression). */
                displaySummary(lifePath, expression) {
                    const lpDisplay = this.formatNumberForDisplay(lifePath);
                    const expDisplay = this.formatNumberForDisplay(expression);
                    const lpText = data.interpretations.cheminDeVie[lifePath.value]?.match(/<strong>(.*?) :<\/strong>/)[1] || "inconnu";
                    const expText = data.interpretations.expression[expression.value]?.match(/<strong>(.*?) :<\/strong>/)[1] || "inconnu";
                    let summaryText = `La cl√© de votre √©panouissement r√©side dans la relation entre votre <strong>mission de vie (Chemin de Vie ${lpDisplay})</strong> et vos <strong>outils inn√©s (Nombre d'Expression ${expDisplay})</strong>.<br><br>Votre mission est de devenir <strong>${lpText}</strong>. Pour y parvenir, vous disposez naturellement des talents d'un(e) <strong>${expText}</strong>. L'art consiste √† utiliser consciemment vos outils pour avancer sur votre chemin.`;
                    
                    if (lifePath.value === expression.value || (lifePath.baseValue && lifePath.baseValue === expression.value)) {
                        summaryText += "<br><br>‚ú® <strong>Synergie Puissante :</strong> Votre mission et vos talents sont en alignement parfait. Cela vous donne une grande force et une clart√© d'objectif, mais attention √† ne pas rester dans votre zone de confort.";
                    } else {
                        summaryText += "<br><br>üí° <strong>Dynamique de Croissance :</strong> Vos outils et votre mission sont diff√©rents. Cette tension est votre plus grande force : elle vous pousse √† d√©velopper de nouvelles facettes de votre personnalit√© pour atteindre votre plein potentiel.";
                    }
                    this.elements.summaryContainer.innerHTML = `<div class="card summary-card" style="border-left-color: var(--summary-border);"><h2>‚ú® Votre Duo Strat√©gique</h2><p>${summaryText}</p></div>`;
                },

                /** G√©n√®re et affiche le graphique en barres des √©nergies pr√©sentes dans le nom. */
                displayEnergyChart(presenceData) {
                    const analysis = this.generateEnergyAnalysis(presenceData);
                    const container = this.elements.energyContainer;
                    // Dimensions du SVG pour la vue de la bo√Æte.
                    const chartWidth = 400; const chartHeight = 170;
                    const barWidth = 30; const barMargin = 15;
                    let maxPresence = Math.max(...Object.values(presenceData));
                    if (maxPresence === 0) maxPresence = 1; // √âvite la division par z√©ro.
                    let svgContent = `<svg width="100%" viewBox="0 0 ${chartWidth} ${chartHeight}" preserveAspectRatio="xMidYMid meet">`;
                    Object.entries(presenceData).forEach(([num, count], index) => {
                        const barHeight = (count / maxPresence) * (chartHeight - 30);
                        const x = index * (barWidth + barMargin);
                        const y = chartHeight - barHeight - 20;
                        svgContent += `<g transform="translate(${x}, 0)"><rect x="0" y="${y}" width="${barWidth}" height="${barHeight}" fill="var(--secondary-color)" rx="3"><title>${data.energyKeywords[num]} (pr√©sent ${count} fois)</title></rect><text x="${barWidth / 2}" y="${chartHeight - 5}" font-family="Poppins" font-size="12" fill="var(--text-color)" text-anchor="middle">${num}</text></g>`;
                    });
                    svgContent += `</svg>`;
                    container.innerHTML = `<div class="card chart-card"><h2 style="font-size: 1.5em;">üìä Vos √ânergies Inn√©es (dans le nom)</h2><p class="description">Ce graphique r√©v√®le vos forces naturelles (barres hautes) et vos axes de d√©veloppement (barres basses ou absentes).</p><div class="energy-chart-svg-container">${svgContent}</div>${analysis}</div>`;
                },

                /** G√©n√®re une analyse textuelle bas√©e sur les √©nergies dominantes et manquantes. */
                generateEnergyAnalysis(presenceData) {
                    const maxCount = Math.max(...Object.values(presenceData));
                    if (maxCount === 0) return "";
                    const maxEnergies = Object.keys(presenceData).filter(k => presenceData[k] === maxCount).map(Number);
                    const lackingEnergies = Object.keys(presenceData).filter(k => presenceData[k] === 0).map(Number);
                    let analysisHTML = '<div class="energy-analysis"><p><strong>Analyse de votre potentiel :</strong> ';
                    analysisHTML += `Vos √©nergies dominantes sont le <strong>${maxEnergies.map(n => `${n} (${data.energyKeywords[n]})`).join(' et le ')}</strong>. Ce sont vos talents les plus √©vidents, des forces sur lesquelles vous pouvez vous appuyer. `;
                    if (lackingEnergies.length > 0) {
                        analysisHTML += `√Ä l'inverse, les √©nergies <strong>${lackingEnergies.map(n => `${n} (${data.energyKeywords[n]})`).join(', ')}</strong> sont vos <strong>axes de croissance</strong>. Int√©grer consciemment ces qualit√©s dans votre vie vous aidera √† surmonter certains blocages et √† trouver un meilleur √©quilibre.`;
                    }
                    analysisHTML += '</p></div>';
                    return analysisHTML;
                },
                
                /** Affiche les cartes des 4 cycles de vie. */
                displayLifeCycles(cyclesData) {
                    let cyclesHTML = `<div class="card cycles-card"><h2 style="font-size: 1.5em;">üß≠ Vos 4 Cycles de Vie</h2><p class="description">Votre vie se divise en grands cycles, chacun avec une ambiance (Pinacle) et une le√ßon √† int√©grer (D√©fi).</p><div class="life-cycles-grid">`;
                    cyclesData.forEach(cycle => { cyclesHTML += `<div class="cycle-card"><h3>${cycle.age}</h3><p><strong>Pinacle ${cycle.pinnacle}:</strong> Opportunit√©s et climat.</p><p><strong>D√©fi ${cycle.challenge}:</strong> Le√ßon √† ma√Ætriser.</p></div>`; });
                    cyclesHTML += `</div></div>`;
                    this.elements.cyclesContainer.innerHTML = cyclesHTML;
                },
                
                /** D√©termine le type de relation (harmonie, d√©fi, neutre) entre deux nombres. */
                getCompatibility(n1, n2) {
                    const r1 = calculator.reduceNumber(n1, false);
                    const r2 = calculator.reduceNumber(n2, false);
                    const rel = data.compatibility.relations[r1];
                    if (!rel) return 'neutral';
                    if (rel.harmony.includes(r2)) return 'harmony';
                    if (rel.challenge.includes(r2)) return 'challenge';
                    return 'neutral';
                },

                /** Affiche les r√©sultats de l'analyse de compatibilit√©. */
                displayCompatibilityResults(p1, p2) {
                    const container = this.elements.compatResultsContainer;
                    container.innerHTML = '';
                    const aspects = [
                        { title: 'Chemins de Vie (Missions)', res1: p1.lifePath, res2: p2.lifePath, desc: "La mission de vie, la le√ßon principale." },
                        { title: 'Nombres d\'Expression (Outils)', res1: p1.expression, res2: p2.expression, desc: "Les talents, le mode de fonctionnement." },
                        { title: 'Nombres d\'√Çme (D√©sirs)', res1: p1.soul, res2: p2.soul, desc: "Les d√©sirs profonds, les motivations intimes." }
                    ];
                    aspects.forEach(aspect => {
                        const type = this.getCompatibility(aspect.res1.value, aspect.res2.value);
                        const typeText = { harmony: 'Harmonie', challenge: 'D√©fi', neutral: 'Neutre' }[type];
                        const card = document.createElement('div');
                        card.className = `card ${type}`;
                        const p1Display = this.formatNumberForDisplay(aspect.res1);
                        const p2Display = this.formatNumberForDisplay(aspect.res2);
                        card.innerHTML = `<h2 style="color: var(--${type}-color);">${typeText} - ${aspect.title}</h2><p><strong>${p1.firstName} (${p1Display}) & ${p2.firstName} (${p2Display})</strong></p><p><em>${aspect.desc}</em></p><p>${data.compatibility.summary[type]}</p>`;
                        container.appendChild(card);
                    });
                    container.classList.remove('hidden');
                    this.animateCards('#compatibility-results .card');
                },
                
                /** Ouvre la modale du glossaire avec les informations sur un nombre sp√©cifique. */
                openGlossaryModal(number) {
                    let html = `<h2>L'√ânergie du Nombre ${number}</h2>`;
                    html += `<p><strong>Mot-cl√© :</strong> ${data.energyKeywords[number]}</p><hr>`;
                    // Parcourt toutes les interpr√©tations pour trouver celles correspondant au nombre.
                    Object.keys(data.interpretations).forEach(key => {
                        if (data.interpretations[key][number]) {
                            const title = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
                            html += `<h3>En ${title} :</h3><div>${data.interpretations[key][number]}</div>`;
                        }
                    });
                    this.elements.modalBody.innerHTML = html;
                    this.elements.glossaryModal.style.display = "block";
                },

                /** Ouvre la modale de m√©thodologie. */
                openMethodologyModal() {
                    const { title, content } = data.methodologyText;
                    this.elements.methodologyModalBody.innerHTML = `<h2>${title}</h2>${content}`;
                    this.elements.methodologyModal.style.display = "block";
                },

                /** Dessine la carte de profil de l'utilisateur sur un √©l√©ment Canvas. */
                drawProfileCard(theme) {
                    this.elements.profileCardContainer.classList.remove('hidden');
                    const canvas = this.elements.profileCardCanvas; const ctx = canvas.getContext('2d');
                    const isDark = document.body.classList.contains('dark-mode');
                    canvas.width = 500; canvas.height = 500;
                    // Cr√©e un fond en d√©grad√© qui s'adapte au th√®me.
                    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                    gradient.addColorStop(0, isDark ? '#2c3e50' : '#4361ee');
                    gradient.addColorStop(1, isDark ? '#1e1e1e' : '#7209b7');
                    ctx.fillStyle = gradient; ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.fillStyle = 'white'; ctx.font = 'bold 32px Lora'; ctx.textAlign = 'center';
                    ctx.fillText(theme.firstName, canvas.width / 2, 80);
                    const numbers = [ { label: "Chemin de Vie", result: theme.lifePath }, { label: "Expression", result: theme.expression }, { label: "√Çme", result: theme.soul }, { label: "Personnalit√©", result: theme.personality } ];
                    ctx.font = '22px Poppins';
                    numbers.forEach((num, index) => {
                        const y = 160 + index * 80;
                        const displayNumber = this.formatNumberForDisplay(num.result);
                        ctx.textAlign = 'left'; ctx.fillText(`${num.label} :`, 100, y);
                        ctx.textAlign = 'right'; ctx.font = 'bold 38px Lora';
                        ctx.fillText(displayNumber, 400, y + 10);
                        ctx.font = '22px Poppins';
                    });
                    this.elements.profileCardContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                },

                /** Applique une animation d'apparition en cascade aux √©l√©ments sp√©cifi√©s par un s√©lecteur CSS. */
                animateCards(selector) {
                    document.querySelectorAll(selector).forEach((card, index) => {
                        card.classList.remove('fade-in'); void card.offsetWidth; // Force le recalcul du style pour r√©-initialiser l'animation.
                        card.style.animationDelay = `${index * 0.07}s`; // Cr√©e un d√©lai pour l'effet de cascade.
                        card.classList.add('fade-in');
                    });
                },

                /** Configure les √©couteurs d'√©v√©nements pour les boutons d'action (Imprimer, Carte, IA). */
                setupActionButtons(theme, resultsMap) {
                    this.elements.printBtn.onclick = () => window.print();
                    this.elements.profileCardBtn.onclick = () => this.drawProfileCard(theme);

                    this.elements.aiExportBtn.innerHTML = '‚ú® R√©v√©ler mon Analyse Strat√©gique Compl√®te';
                    // Ajoute (ou met √† jour) la description sous le bouton de l'IA.
                    let existingDesc = this.elements.aiExportBtn.nextElementSibling;
                    if(existingDesc && existingDesc.classList.contains('ai-prompt-description')) {
                        existingDesc.remove();
                    }
                    const aiDesc = document.createElement('p');
                    aiDesc.className = 'ai-prompt-description';
                    aiDesc.innerHTML = "Copie un prompt optimis√© √† coller dans une IA (ChatGPT, Gemini, etc.) pour une analyse qui tisse des liens entre tous vos nombres.";
                    this.elements.aiExportBtn.insertAdjacentElement('afterend', aiDesc);
                    
                    // G√®re la copie du prompt pour l'IA dans le presse-papiers.
                    this.elements.aiExportBtn.onclick = () => {
                        let resultsForAI = '';
                        resultsMap.forEach((data, title) => {
                            const displayNumber = this.formatNumberForDisplay(data.result);
                            resultsForAI += `${title}: ${displayNumber}${data.result.karmicDebt ? ` (Dette Karmique ${data.result.karmicDebt})` : ''}\n`;
                        });
                        // Ce prompt est soigneusement con√ßu pour guider l'IA vers une analyse de haute qualit√©.
                        // Il d√©finit le r√¥le, fournit les donn√©es structur√©es et demande une sortie sp√©cifique.
                        const aiPrompt = `# CONTEXTE\nAgis comme un expert en num√©rologie strat√©gique. Analyse le th√®me suivant.\n\n# TH√àME NUM√âROLOGIQUE\n${resultsForAI.trim()}\n\n# CYCLES DE VIE\n${JSON.stringify(theme.lifeCycles, null, 2)}\n\n# √âNERGIES DU NOM (Pr√©sence des nombres de 1 √† 9)\n${JSON.stringify(theme.energyPresence, null, 2)}\n\n# TA MISSION\nEn te basant sur TOUTES ces donn√©es, r√©dige une analyse compl√®te et bienveillante. Ta valeur est de TISSER DES LIENS entre les nombres pour r√©v√©ler les synergies, les d√©fis et le potentiel global. Prends en compte la vibration compl√®te des ma√Ætres nombres (ex: la dualit√© travail/vision du 22/4).\n\nStructure ta r√©ponse ainsi :\n1. **Synth√®se Strat√©gique (Le Duo Cl√©) :** Explique la dynamique centrale entre le Chemin de Vie (la mission) et le Nombre d'Expression (les outils). Comment ces deux nombres interagissent-ils ? Est-ce une synergie ou un d√©fi de croissance ?\n2. **Forces Principales & Potentiel :** Identifie 2-3 associations positives entre les diff√©rents nombres (ex: √Çme et Personnalit√© align√©es, √©nergies dominantes du nom qui soutiennent le Chemin de Vie). Explique comment exploiter ce potentiel.\n3. **Axes de Croissance (D√©fis & Freins) :** Analyse les tensions, les dettes karmiques et les √©nergies manquantes du nom. Donne un conseil concret pour transformer chaque d√©fi en une opportunit√© de croissance.\n4. **Feuille de Route pour la P√©riode Actuelle :** En se basant sur le cycle de vie actuel (consid√©rer que nous sommes en ${new Date().getFullYear()}), quel est le principal conseil pour la p√©riode que la personne traverse ?\n5. **Conseil Final :** R√©sume le potentiel unique de cette personne en une phrase puissante et donne un conseil final actionnable.`;
                        navigator.clipboard.writeText(aiPrompt.trim()).then(() => { 
                            const originalText = this.elements.aiExportBtn.innerHTML; 
                            this.elements.aiExportBtn.innerHTML = '‚úÖ Copi√© dans le presse-papiers !'; 
                            this.elements.aiExportBtn.disabled = true; 
                            setTimeout(() => { this.elements.aiExportBtn.innerHTML = originalText; this.elements.aiExportBtn.disabled = false; }, 2500); 
                        });
                    };
                }
            };
            // Lance l'initialisation de l'interface utilisateur.
            ui.init();
        });
    </script>
</body>
</html>
